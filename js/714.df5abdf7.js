"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[714],{90031:function(e,t,s){var i=s(66252),a=s(24150);class n{constructor(){this.prefix="general-conversations"}async addQuestion(e){const t=new FormData;if(t.append("question",e.question),e.media&&e.media.length>0)for(let i=0;i<e.media.length;i++)t.append("media[]",e.media[i]);try{const e=await a.hi.post(`${this.prefix}/questions`,t,{headers:{"Content-type":"multipart/form-data"}});return e.data}catch(s){(0,i.S3)(s)}}async addAnswer(e){const t=new FormData;t.append("answer",e.answer),t.append("question_id",e.question_id),e.image&&t.append("image",e.image);try{const e=await a.hi.post(`${this.prefix}/answers`,t,{headers:{"Content-type":"multipart/form-data"}});return e.data}catch(s){(0,i.S3)(s)}}async getQuestions(e){try{const t=await a.hi.get(`${this.prefix}/questions?page=${e}`);return t.data}catch(t){(0,i.S3)(t)}}async getQuestionById(e){try{const t=await a.hi.get(`${this.prefix}/questions/${e}`);return t.data}catch(t){(0,i.S3)(t)}}async getMyQuestions(e){try{const t=await a.hi.get(`${this.prefix}/questions/my-questions?page=${e}`);return t.data}catch(t){(0,i.S3)(t)}}async getAssignedToMeQuestions(e){try{const t=await a.hi.get(`${this.prefix}/questions/assigned-to-me?page=${e}`);return t.data}catch(t){(0,i.S3)(t)}}async solveQuestion(e){try{const t=await a.hi.put(`${this.prefix}/questions/${e}/solve`);return t.data}catch(t){(0,i.S3)(t)}}async closeQuestion(e){try{const t=await a.hi.put(`${this.prefix}/questions/${e}/close`);return t.data}catch(t){(0,i.S3)(t)}}async assignToParent(e){try{const t=await a.hi.put(`${this.prefix}/questions/${e}/assign-to-parent`);return t.data}catch(t){(0,i.S3)(t)}}async getStatistics(){try{const e=await a.hi.get(`${this.prefix}/questions/statistics`);return e.data}catch(e){(0,i.S3)(e)}}async closeOverdueQuestions(){try{const e=await a.hi.put(`${this.prefix}/questions/close-overdue`);return e.data}catch(e){(0,i.S3)(e)}}async addWorkingHours(e,t){try{const s=await a.hi.post(`${this.prefix}/working-hours`,{date:e,minutes:t});return s.data}catch(s){(0,i.S3)(s)}}async getWorkingHours(){try{const e=await a.hi.get(`${this.prefix}/working-hours`);return e.data}catch(e){(0,i.S3)(e)}}async getWorkingHoursStatistics(e=""){try{const t=await a.hi.get(`${this.prefix}/working-hours/statistics?date=${e}`);return t.data}catch(t){(0,i.S3)(t)}}async addFollowup(){try{const e=await a.hi.post(`${this.prefix}/followup`);return e.data}catch(e){(0,i.S3)(e)}}async getFollowupStatistics(){try{const e=await a.hi.get(`${this.prefix}/followup/statistics`);return e.data}catch(e){(0,i.S3)(e)}}}t.Z=new n},53186:function(e,t,s){s.d(t,{Z:function(){return p}});s(76801),s(43843);var i=s(66252);const a={class:"preview-images"},n=["onClick"],o=(0,i._)("span",null," x ",-1),r=[o],l=["src"],d=["src"];function u(e,t,s,o,u,c){return(0,i.wg)(),(0,i.iD)("div",a,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(u.previewUrls,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"image-container",key:e.url},[(0,i._)("div",{class:"delete-image",onClick:e=>c.removeMedia(t)},r,8,n),e.type.includes("image")?((0,i.wg)(),(0,i.iD)("img",{key:0,src:e.url},null,8,l)):((0,i.wg)(),(0,i.iD)("video",{key:1,src:e.url,autoplay:""},null,8,d))])))),128))])}s(76265),s(70560);var c={name:"ImagePreviewer",props:{media:{type:[Array,FileList],default:()=>[]}},emits:["remove-media"],data(){return{previewUrls:[]}},methods:{previewMedia(){this.previewUrls=[];const e=[...this.media];e.forEach((e=>{const t=new FileReader;t.onload=()=>{this.previewUrls.push({url:t.result,type:e.type})},t.readAsDataURL(e)}))},removeMedia(e){this.previewUrls.splice(e,1),this.$emit("remove-media",e)},clearMedia(){this.previewUrls=[]}},mounted(){this.previewMedia()},watch:{media(){this.previewMedia()}}},h=s(83744);const g=(0,h.Z)(c,[["render",u]]);var p=g},50714:function(e,t,s){s.r(t),s.d(t,{default:function(){return Ve}});s(76265);var i=s(66252),a=s(3577);const n=e=>((0,i.dD)("data-v-4643f242"),e=e(),(0,i.Cn)(),e),o={key:0,class:"col-sm-12 text-center"},r=["src"],l={key:1,class:"row"},d=n((()=>(0,i._)("div",{class:"col-sm-12"},[(0,i._)("div",{class:"card position-relative inner-page-bg bg-primary mb-2",style:{height:"80px"}},[(0,i._)("div",{class:"inner-page-title"},[(0,i._)("h2",{class:"text-white"},"التحويل العام")])])],-1))),u={key:1,class:"col-12 my-2"},c={key:0,class:"col-sm-12 text-center"},h=["src"],g={key:1},p={class:"col-12"},w={class:"card card-block card-stretch card-height blog"},m={key:0,class:"card-header"},y={class:"card-body"},f={class:"blog-description"},v={class:"col-lg-12 mb-3"},b={key:0,class:"d-flex align-items-center justify-content-start"},_={class:"me-2"},q={key:2,class:"col-sm-12 text-center"},k=["src"],x={key:3,class:"col-12"},D={class:"card card-block card-stretch card-height blog"},$=["disabled"];function Q(e,t,n,Q,C,A){const F=(0,i.up)("AddQuestion"),T=(0,i.up)("FilterQuestion"),Z=(0,i.up)("font-awesome-icon"),S=(0,i.up)("Questions");return C.loadingClose?((0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("img",{src:s(79885),alt:"loader",style:{height:"100px"}},null,8,r)])):((0,i.wg)(),(0,i.iD)("div",l,[d,C.questionId?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(F,{key:0,onAddQuestion:A.addNewQuestion},null,8,["onAddQuestion"])),!C.questionId&&C.showFollowupButton?((0,i.wg)(),(0,i.iD)("div",u,[(0,i._)("button",{class:"btn btn-info",onClick:t[0]||(t[0]=(...e)=>A.addFollowupAction&&A.addFollowupAction(...e))},[C.loadingFollowupAddition?((0,i.wg)(),(0,i.iD)("div",c,[(0,i._)("img",{src:s(79885),alt:"loader",style:{height:"30px"}},null,8,h)])):((0,i.wg)(),(0,i.iD)("span",g,(0,a.zw)(A.counterText),1))])])):(0,i.kq)("",!0),(0,i._)("div",p,[(0,i._)("div",w,[C.questionId?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",m,[(0,i._)("h2",null,(0,a.zw)(A.title),1)])),(0,i._)("div",y,[(0,i._)("div",f,[(0,i._)("div",v,[C.questionId?((0,i.wg)(),(0,i.iD)("button",{key:1,class:"bg-primary rounded badge text-white border-0 ms-1 me-1",onClick:t[1]||(t[1]=(...e)=>A.backToQuestions&&A.backToQuestions(...e))}," الكل ")):((0,i.wg)(),(0,i.j4)(T,{key:0,filterQuestions:A.filterQuestions},null,8,["filterQuestions"]))]),C.emptyMessage?((0,i.wg)(),(0,i.iD)("div",b,[(0,i._)("div",_,[(0,i.Wm)(Z,{icon:["fas","circle-exclamation"],size:"xl"})]),(0,i._)("div",null,(0,a.zw)(C.emptyMessage),1)])):((0,i.wg)(),(0,i.j4)(S,{key:1,questions:C.questions,onUpdateKey:A.updateKey},null,8,["questions","onUpdateKey"])),C.loading?((0,i.wg)(),(0,i.iD)("div",q,[(0,i._)("img",{src:s(79885),alt:"loader",style:{height:"100px"}},null,8,k)])):(0,i.kq)("",!0),C.hasMore&&C.questions.length>0?((0,i.wg)(),(0,i.iD)("div",x,[(0,i._)("div",D,[(0,i._)("button",{type:"button",class:"btn btn-primary d-block w-100",onClick:t[2]||(t[2]=(...e)=>A.loadMore&&A.loadMore(...e)),disabled:C.loading}," تحميل المزيد من الأسئلة ",8,$)])])):(0,i.kq)("",!0)])])])])]))}var C=s(43144),A=(s(70560),s(91719),s(64043),s(57267),s(49579)),F=s(49963);const T=(0,i._)("h4",{class:"card-title"},"طرح سؤال",-1),Z={class:"d-flex align-items-center"},S={class:"post-text ml-3 w-100"},M=(0,i._)("hr",null,null,-1),I={key:1,class:"col-sm-12 text-center"},B=["src"],U=["disabled"];function R(e,t,a,n,o,r){const l=(0,i.up)("BaseAvatar"),d=(0,i.up)("ImagePreviewer"),u=(0,i.up)("iq-card");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(u,{id:"question-modal-data","body-class":"iq-card iq-card-block iq-card-stretch iq-card-height"},{headerTitle:(0,i.w5)((()=>[T])),body:(0,i.w5)((()=>{var e,a,n,u;return[(0,i._)("div",Z,[(0,i.Wm)(l,{profileImg:null===(e=r.auth)||void 0===e||null===(e=e.user_profile)||void 0===e?void 0:e.profile_picture,profile_id:null===(a=r.auth)||void 0===a||null===(a=a.user_profile)||void 0===a?void 0:a.id,title:null===(n=r.auth)||void 0===n?void 0:n.name,gender:null===(u=r.auth)||void 0===u?void 0:u.gender,avatarClass:"avatar-60 rounded-circle"},null,8,["profileImg","profile_id","title","gender"]),(0,i._)("form",S,[(0,i.wy)((0,i._)("textarea",{id:"question-editor",placeholder:"اطرح سؤالك هنا...",class:"rounded form-control",style:{border:"none","max-height":"50vh"},"onUpdate:modelValue":t[0]||(t[0]=e=>o.question.question=e),ref:"questionRef"},"\n            ",512),[[F.nr,o.question.question,void 0,{trim:!0}]]),(0,i._)("input",{type:"file",onChange:t[1]||(t[1]=e=>r.previewMedia(e)),multiple:"",accept:"image/*",class:"d-none",ref:"fileRef"},null,544)])]),o.question.media.length>0?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[M,(0,i.Wm)(d,{media:o.question.media,onRemoveMedia:r.removeMedia},null,8,["media","onRemoveMedia"])],64)):(0,i.kq)("",!0),o.loader?((0,i.wg)(),(0,i.iD)("div",I,[(0,i._)("img",{src:s(79885),alt:"loader",style:{height:"100px"}},null,8,B)])):((0,i.wg)(),(0,i.iD)("button",{key:2,class:"btn btn-primary btn-block my-3 w-100 flex-grow-1",onClick:t[2]||(t[2]=e=>r.addNewQuestion()),disabled:!r.allowPosting}," نشـــر ",8,U))]})),_:1})])}var z=s(53186),W=s(8209),P=s(90031),E={name:"AddQuestion",components:{ImagePreviewer:z.Z},emits:["add-question"],data(){return{question:{question:"",media:[]},loader:!1}},computed:{auth(){return this.$store.getters.getUser},allowPosting(){return""!==this.question.question},questionBody(){return this.question.question}},watch:{questionBody(){this.$refs.questionRef.style.height="auto",this.$nextTick((()=>{this.$refs.questionRef.style.height=this.$refs.questionRef.scrollHeight+"px"}))}},methods:{openFilePicker(){this.$refs.fileRef.click()},previewMedia(e){const t=[...e.target.files];this.question.media=t},removeMedia(e){const t=[...this.question.media];t.splice(e,1),this.question.media=t,0===this.question.media.length&&(this.$refs.fileRef.value=null)},async addNewQuestion(){this.loader=!0;try{const e=await P.Z.addQuestion(this.question);this.$emit("add-question",e.data),this.question={question:"",media:[]}}catch(e){W.Z.toggleErrorToast()}finally{this.loader=!1}}}},K=s(83744);const j=(0,K.Z)(E,[["render",R]]);var H=j;const N={class:"accordion",id:"questions-accordion"},O={class:"card card-block card-stretch card-height blog"},Y={class:"card-body"},L={class:"accordion-item mb-3"},V={class:"mt-3 d-flex align-items-center justify-content-start w-100"},G={class:"ms-3"},J={class:"accordion-header",id:"heading1"},X=["data-bs-target","aria-controls"],ee=["id"],te={class:"accordion-body"},se={key:0},ie={key:1},ae={class:"d-flex align-items-center justify-content-start w-100 mb-2"},ne={class:"ms-3"},oe={class:""},re={class:"d-flex flex-wrap align-items-center comment-activity"},le={key:0},de={class:"my-2"},ue={key:2,class:"mt-3 d-flex align-content-start flex-wrap"},ce=["onClick","disabled"],he=["src"],ge={key:1},pe=["onClick","disabled"],we=["src"],me={key:1},ye=["onClick"],fe=["src"],ve={key:1};function be(e,t,n,o,r,l){const d=(0,i.up)("BaseAvatar"),u=(0,i.up)("tooltip"),c=(0,i.up)("AddAnswer"),h=(0,i.up)("QuestionStat");return(0,i.wg)(),(0,i.iD)("div",N,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.questions,(t=>((0,i.wg)(),(0,i.iD)("div",{class:"cols",key:t.id},[(0,i._)("div",O,[(0,i._)("div",Y,[(0,i._)("div",L,[(0,i._)("div",V,[(0,i.Wm)(d,{profileImg:t.user.profile.profile_picture,profile_id:t.user.profile.id,title:t.user.name,gender:t.user.gender,avatarClass:"rounded-circle avatar-40"},null,8,["profileImg","profile_id","title","gender"]),(0,i._)("div",G,[(0,i._)("h6",null,(0,a.zw)(t.user.name),1)])]),(0,i._)("h2",J,[(0,i._)("button",{class:"rtl accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+t.id,"aria-expanded":"true","aria-controls":"collapse"+t.id},(0,a.zw)(t.question),9,X)]),(0,i._)("div",{id:"collapse"+t.id,class:"accordion-collapse collapse","aria-labelledby":"heading1","data-bs-parent":"#questions-accordion"},[(0,i._)("div",te,[0===t.answers.length?((0,i.wg)(),(0,i.iD)("p",se,"لا يوجد إجابات")):((0,i.wg)(),(0,i.iD)("h3",ie,"الإجابات")),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.answers,(s=>{var n,o,r,l;return(0,i.wg)(),(0,i.iD)("div",{class:"mt-3 w-100",key:s.id},[(0,i._)("div",ae,[(0,i.Wm)(d,{profileImg:null===(n=s.user)||void 0===n?void 0:n.profile.profile_picture,profile_id:null===(o=s.user)||void 0===o?void 0:o.profile.id,title:null===(r=s.user)||void 0===r?void 0:r.name,gender:null===(l=s.user)||void 0===l?void 0:l.gender,avatarClass:"rounded-circle avatar-40"},null,8,["profileImg","profile_id","title","gender"]),(0,i._)("div",ne,[(0,i._)("h6",null,(0,a.zw)(s.user.name),1)])]),(0,i._)("div",null,[(0,i._)("p",oe,(0,a.zw)(s.answer),1),(0,i._)("div",re,[(0,i.Wm)(u,{tag:"span",class:"text-muted small",tooltipPlacement:"bottom","data-bs-toggle":"tooltip",title:e.formatFullDate(s.created_at)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.formatDateToWritten(s.created_at)),1)])),_:2},1032,["title"])])]),s.id!==t.answers[t.answers.length-1].id?((0,i.wg)(),(0,i.iD)("hr",le)):(0,i.kq)("",!0)])})),128)),(0,i._)("div",de,["open"===t.status?((0,i.wg)(),(0,i.j4)(c,{key:0,question_id:t.id},null,8,["question_id"])):(0,i.kq)("",!0)]),(0,i.Wm)(h,{question:t},null,8,["question"]),"open"===t.status?((0,i.wg)(),(0,i.iD)("div",ue,[l.canEdit(t)?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i._)("button",{class:"bg-primary rounded badge text-white border-0 ms-1 me-1",onClick:e=>l.solveQuestion(t),disabled:r.loadingSolve},[r.loadingSolve?((0,i.wg)(),(0,i.iD)("img",{key:0,src:s(79885),alt:"loader",style:{height:"20px"}},null,8,he)):((0,i.wg)(),(0,i.iD)("span",ge," تم الحل "))],8,ce),(0,i._)("button",{class:"bg-danger rounded badge text-white border-0 ms-1 me-1",onClick:e=>l.closeQuestion(t),disabled:r.loadingClose},[r.loadingClose?((0,i.wg)(),(0,i.iD)("img",{key:0,src:s(79885),alt:"loader",style:{height:"20px"}},null,8,we)):((0,i.wg)(),(0,i.iD)("span",me," إغلاق "))],8,pe)],64)):(0,i.kq)("",!0),t.assignee.id!==l.auth.id||l.isAssigneeAdmin(t.assignee)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:1,class:"bg-dark rounded badge text-white border-0 ms-1 me-1",onClick:e=>l.assignToParent(t)},[r.loadingAssign?((0,i.wg)(),(0,i.iD)("img",{key:0,src:s(79885),alt:"loader",style:{height:"20px"}},null,8,fe)):((0,i.wg)(),(0,i.iD)("span",ve," تعيين إلى اسم المسؤول "))],8,ye))])):(0,i.kq)("",!0)])],8,ee)])])])])))),128))])}const _e={class:"d-flex flex-column"},qe={class:"comment-attagement right d-flex mb-1"},ke=["disabled"];function xe(e,t,s,n,o,r){return(0,i.wg)(),(0,i.iD)("div",_e,[(0,i._)("form",{class:"comment-text d-flex align-items-end mt-3",onSubmit:t[1]||(t[1]=(0,F.iM)(((...e)=>r.addAnswer&&r.addAnswer(...e)),["prevent"]))},[(0,i.wy)((0,i._)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.v$.answerData.answer.$model=e),class:"form-control rounded",placeholder:"أضف إجابة",style:(0,a.j5)([{"padding-right":"3rem !important"},{direction:"rtl","max-height":"120px",resize:"none",overflow:"auto"}]),rows:1,ref:"bodyRef"},null,512),[[F.nr,n.v$.answerData.answer.$model,void 0,{trim:!0}]]),(0,i._)("div",qe,[(0,i._)("button",{type:"submit",class:(0,a.C_)(["material-symbols-outlined ms-2 border-0 bg-transparent",{"text-primary":!n.v$.answerData.$invalid,disabled:n.v$.answerData.$invalid}]),disabled:n.v$.answerData.$invalid||o.loading}," Send ",10,ke)])],32)])}var De=s(5705),$e=s(10760),Qe={name:"AddAnswer",setup(){const e=(0,De.ZP)();return{v$:e}},emits:["add-answer"],inject:{addNewAnswer:{default:()=>()=>{}}},props:{question_id:{type:Number,required:!0}},data(){return{loading:!1,answerData:{answer:"",image:null,question_id:this.question_id}}},computed:{answerBody(){return this.answerData.answer}},watch:{answerBody(){this.$refs.bodyRef.style.height="auto",this.$nextTick((()=>{this.$refs.bodyRef.style.height=this.$refs.bodyRef.scrollHeight+"px"}))}},methods:{async addAnswer(){if(!this.loading)if(this.v$.$touch(),this.v$.answerData.$invalid)W.Z.toggleToast("يرجى إدخال البيانات","error");else{this.loading=!0;try{const e=await P.Z.addAnswer(this.answerData);this.addNewAnswer(e.data),this.answerData.answer="",this.answerData.image=null,this.v$.$reset(),W.Z.toggleToast("تم إضافة الجواب ","success")}catch(e){W.Z.toggleErrorToast("حدث خطأ ما, حاول مرة أخرى")}finally{this.loading=!1}}}},validations(){return{answerData:{answer:{required:$e.C1}}}}};const Ce=(0,K.Z)(Qe,[["render",xe],["__scopeId","data-v-0c5c061b"]]);var Ae=Ce;const Fe={class:"mt-3 d-flex align-content-start flex-wrap"},Te={class:"ms-2 me-2"},Ze={class:"ms-2 me-2"},Se=(0,i._)("span",{class:"align-middle material-symbols-outlined"}," forum ",-1),Me=(0,i._)("span",{class:"align-middle material-symbols-outlined"}," person_check ",-1),Ie={style:{"font-weight":"bold"}};function Be(e,t,s,n,o,r){return(0,i.wg)(),(0,i.iD)("div",Fe,[(0,i._)("small",Te,[(0,i._)("span",{class:(0,a.C_)(["align-middle material-symbols-outlined",o.isWarning?"text-warning":"text-success"])},(0,a.zw)(o.isWarning?"warning":"task_alt"),3),(0,i.Uk)(" "+(0,a.zw)(r.getStatusText()),1)]),(0,i._)("small",Ze,[Se,(0,i.Uk)(" "+(0,a.zw)(s.question.answers.length>0?`${s.question.answers.length} إجابات`:"لا يوجد إجابات"),1)]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.question.user_parents,(e=>((0,i.wg)(),(0,i.iD)("small",{class:"ms-2 me-2",key:e.role},[Me,(0,i._)("span",Ie,(0,a.zw)(`${e.role}:`),1),(0,i.Uk)(" "+(0,a.zw)(e.name),1)])))),128))])}var Ue={name:"QuestionStat",data(){return{isWarning:!1}},props:{question:{type:Object,required:!0}},methods:{getStatusText(){var e;switch(null===(e=this.question)||void 0===e?void 0:e.status){case"open":{const{hours:e}=W.Z.getDifferenceBetweenDates(this.question.created_at,new Date);return e>=48?(this.isWarning=!0,"مفتوح لأكثر من يومين"):"لم يتم الحل"}case"closed":return"مغلق";case"solved":{this.isWarning=!1;const{hours:e}=W.Z.getDifferenceBetweenDates(this.question.created_at,this.question.updated_at);return e<=12?"تم الحل خلال 12 ساعة":"تم الحل بعد أكثر من 12 ساعة"}default:return"غير معروف"}}}};const Re=(0,K.Z)(Ue,[["render",Be]]);var ze=Re,We={name:"Questions",components:{QuestionStat:ze,AddAnswer:Ae},data(){return{loadingSolve:!1,loadingClose:!1,loadingAssign:!1}},emits:["updateKey"],props:{questions:{type:Array,required:!0}},computed:{auth(){return this.$store.getters.getUser}},methods:(0,C.Z)((0,C.Z)({},W.Z),{},{canEdit(e){return e.user.id===this.auth.id||e.assignee.id===this.auth.id||A.Z.hasRole(this.auth,"admin")},async solveQuestion(e){if(!this.loadingSolve){this.loadingSolve=!0;try{const t=await P.Z.solveQuestion(e.id);this.$emit("updateKey",e,"status",t.data.status),this.$emit("updateKey",e,"updated_at",t.data.updated_at),this.toggleToast("تم حل السؤال","success")}catch(t){this.toggleErrorToast()}finally{this.loadingSolve=!1}}},async closeQuestion(e){if(!this.loadingClose){this.loadingClose=!0;try{const t=await P.Z.closeQuestion(e.id);this.$emit("updateKey",e,"status",t.data.status),this.$emit("updateKey",e,"updated_at",t.data.updated_at),this.toggleToast("تم إغلاق السؤال","success")}catch(t){this.toggleErrorToast()}finally{this.loadingClose=!1}}},async assignToParent(e){if(!this.loadingAssign){this.loadingAssign=!0;try{const t=await P.Z.assignToParent(e.id);this.$emit("updateKey",e,"assignee",t.data.assignee),this.toggleToast("تم تعيين السؤال للمشرف","success")}catch(t){this.toggleErrorToast()}finally{this.loadingAssign=!1}}},isAssigneeAdmin(e){return A.Z.hasRole(e.assignee,"admin")}})};const Pe=(0,K.Z)(We,[["render",be],["__scopeId","data-v-c96ceb2e"]]);var Ee=Pe;const Ke={class:"my-2 d-flex align-content-start flex-wrap"};function je(e,t,s,a,n,o){return(0,i.wg)(),(0,i.iD)("div",Ke,[(0,i._)("button",{class:"bg-primary rounded badge text-white border-0 ms-1 me-1",onClick:t[0]||(t[0]=e=>s.filterQuestions("all"))}," الكل "),(0,i._)("button",{class:"bg-dark rounded badge text-white border-0 ms-1 me-1",onClick:t[1]||(t[1]=e=>s.filterQuestions("my-questions"))}," أسئلتي "),(0,i._)("button",{class:"bg-danger rounded badge text-white border-0 ms-1 me-1",onClick:t[2]||(t[2]=e=>s.filterQuestions("assigned-to-me"))}," معينة لي ")])}var He={name:"FilterQuestion",props:{filterQuestions:{type:Function,required:!0}}};const Ne=(0,K.Z)(He,[["render",je]]);var Oe=Ne,Ye={name:"GeneralConversation",components:{AddQuestion:H,Questions:Ee,FilterQuestion:Oe},provide(){return{addNewAnswer:this.addNewAnswer}},async created(){await this.checkUserPermission(),await this.getQuestions(),this.followupCounter=this.userFollowup?this.userFollowup.counter:0},data(){return{questions:[],loading:!1,emptyMessage:"",keyword:"all",loadingClose:!1,hasMore:!1,page:1,questionId:this.$route.params.questionId||null,userFollowup:null,showFollowupButton:!1,followupCounter:null,loadingFollowupAddition:!1}},computed:{auth(){return this.$store.getters.getUser},title(){return"my-questions"===this.keyword?"أسئلتي":"assigned-to-me"===this.keyword?"الأسئلة المعينة لي":"كل الأسئلة"},counterText(){return 0===this.followupCounter?"التفقد الأول":"التفقد الثاني"}},watch:{keyword:function(e){this.emptyMessage="",this.page=1,this.hasMore=!1,this.questions=[],this.getQuestions()},userFollowup:function(e){if((null===e||void 0===e?void 0:e.counter)>=2)return void(this.showFollowupButton=!1);if(!e)return void(this.showFollowupButton=!0);const t=new Date,s=new Date(null===e||void 0===e?void 0:e.updated_at),i=Math.abs(t-s),a=Math.ceil(i/36e5);this.showFollowupButton=!(a<6)}},methods:(0,C.Z)((0,C.Z)({},W.Z),{},{checkUserPermission(){A.Z.hasRoles(this.auth,["admin","consultant","advisor","supervisor","leader"])||this.$router.push({name:"NotFound"})},addNewQuestion(e){this.questions.unshift(e)},addNewAnswer(e){const t=this.questions.find((t=>t.id===e.question_id));t&&t.answers.push(e)},async getQuestions(){if(!this.loading){this.loading=!0;try{let e;if(this.questionId)return e=await P.Z.getQuestionById(this.questionId),e.data?(this.questions=[e.data],void(this.hasMore=!1)):void(this.emptyMessage=e.message);if("all"===this.keyword||""===this.keyword?e=await P.Z.getQuestions(this.page):"my-questions"===this.keyword?e=await P.Z.getMyQuestions(this.page):"assigned-to-me"===this.keyword&&(e=await P.Z.getAssignedToMeQuestions(this.page)),0===e.data.questions.length)return this.emptyMessage=e.message,void(this.userFollowup=e.data.user_followup);this.questions=[...this.questions,...e.data.questions],this.hasMore=e.data.has_more_pages,this.userFollowup=e.data.user_followup}catch(e){this.toggleErrorToast()}finally{this.loading=!1}}},async filterQuestions(e){this.keyword=e},async loadMore(){this.page++,await this.getQuestions()},updateKey(e,t,s){e[t]=s},async closeOverdueQuestions(){if(!this.loadingClose){this.loadingClose=!0;try{await P.Z.closeOverdueQuestions()}catch(e){this.toggleErrorToast()}finally{this.loadingClose=!1}}},backToQuestions(){this.$router.replace({name:"general-conversation.index"}),this.questionId=null,this.questions=[],this.getQuestions()},checkFollowup(){if(this.userFollowup){const e=new Date,t=new Date(this.userFollowup.updated_at),s=Math.abs(e-t)/36e5;console.log(this.userFollowup),s<6&&(this.showFollowupButton=!1)}},async addFollowupAction(){if(!this.loadingFollowupAddition&&!(this.followupCounter>=2))if(1!==this.followupCounter){const e=this.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg"},buttonsStyling:!1});e.fire({title:"تنويه",text:"لا يمكنك إدخال التفقد الثاني إلا بعد مرور 6 ساعات على إدخال التفقد الأول",showCancelButton:!1,confirmButtonText:"حسنًا",icon:"warning",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then((async e=>{e.isConfirmed&&await this.addFollowup()}))}else await this.addFollowup()},async addFollowup(){this.loadingFollowupAddition=!0;try{const e=await P.Z.addFollowup();setTimeout((()=>{this.$swal.fire({title:"تم إضافة التفقد بنجاح",icon:"success",showCancelButton:!1,confirmButtonText:"حسنًا",customClass:{confirmButton:"btn btn-primary btn-lg"},buttonsStyling:!1}),this.userFollowup=e.data}),1e3)}catch(e){this.toggleErrorToast()}finally{this.loadingFollowupAddition=!1}}})};const Le=(0,K.Z)(Ye,[["render",Q],["__scopeId","data-v-4643f242"]]);var Ve=Le},27413:function(e,t,s){var i=s(44201),a=i("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(s){try{return t[a]=!1,"/./"[e](t)}catch(i){}}return!1}},98494:function(e,t,s){var i=s(23691),a=TypeError;e.exports=function(e,t){if(!delete e[t])throw new a("Cannot delete property "+i(t)+" of "+i(e))}},42124:function(e,t,s){var i=s(91245),a=TypeError;e.exports=function(e){if(i(e))throw new a("The method doesn't accept regular expressions");return e}},76801:function(e,t,s){var i=s(79989),a=s(84328).includes,n=s(3689),o=s(87370),r=n((function(){return!Array(1).includes()}));i({target:"Array",proto:!0,forced:r},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},91719:function(e,t,s){var i=s(79989),a=s(90690),n=s(6310),o=s(5649),r=s(98494),l=s(55565),d=1!==[].unshift(0),u=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},c=d||!u();i({target:"Array",proto:!0,arity:1,forced:c},{unshift:function(e){var t=a(this),s=n(t),i=arguments.length;if(i){l(s+i);var d=s;while(d--){var u=d+i;d in t?t[u]=t[d]:r(t,u)}for(var c=0;c<i;c++)t[c]=arguments[c]}return o(t,s+i)}})},43843:function(e,t,s){var i=s(79989),a=s(68844),n=s(42124),o=s(74684),r=s(34327),l=s(27413),d=a("".indexOf);i({target:"String",proto:!0,forced:!l("includes")},{includes:function(e){return!!~d(r(o(this)),r(n(e)),arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=714.df5abdf7.js.map