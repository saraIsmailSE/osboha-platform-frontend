"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[455],{94268:function(e,t,s){var r=s(24150);class a{constructor(){this.prefix="audit-marks"}async groupAuditMarks(e){try{const t=await r.hi.get(`${this.prefix}/group-audit-marks/${e}`).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}async markForAudit(e){try{const t=await r.hi.get(`${this.prefix}/mark-for-audit/${e}`).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}async updateMarkForAuditStatus(e,t){try{const s=r.hi.patch(`${this.prefix}/update-mark-for-audit-status/${t}`,{status:e}).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return s.data.data}catch(s){return s}}async addNote(e){try{const t=await r.hi.post(`/${this.prefix}/add-note`,e,{headers:{"Content-type":"multipart/form-data"}}).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}async groupsAudit(e){try{const t=await r.hi.get(`/${this.prefix}/groups-audit/${e}`).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}async supervisorsAudit(e){try{const t=await r.hi.get(`/${this.prefix}/supervisors-audit/${e}`).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}async advisorMainAudit(e){try{const t=await r.hi.get(`/${this.prefix}/advisor-main-audit/${e}`).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}async getNotes(e){try{const t=await r.hi.get(`/${this.prefix}/get-notes/${e}`).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}async pendingTheses(e){try{const t=await r.hi.get(`/${this.prefix}/pending-theses/${e}`).catch((e=>{e.response?(0,r.LO)(e.response.status):e.request?console.log(e.request):console.log("Error",e.message)}));return t.data.data}catch(t){return t}}}t.Z=new a},63543:function(e,t,s){s.r(t),s.d(t,{default:function(){return ae}});var r=s(66252),a=s(3577);const o={class:"col-sm-12 mt-3"},i={class:"iq-card-header-toolbar d-flex align-items-center mx-auto"},n={key:0,class:"text-center mt-3 mb-3",style:{direction:"rtl"}},d={class:"text-center"},c={class:"iq-card-body p-3"},u={class:"d-flex align-items-center mt-3"},l={key:1,class:"alert alert-secondary w-100 text-center",role:"alert"},m={class:"d-flex align-items-center mt-3 row"},p={key:0,class:"text-center mb-3"},h={key:0,class:"alert alert-primary mt-2"},g={class:"d-flex align-items-center mt-3 row"},k={class:"d-inline-block w-100 text-center col-12"},_=(0,r._)("span",null,"عودة",-1),y=(0,r._)("span",{class:"align-middle material-symbols-outlined"}," keyboard_return ",-1),b=[_,y];function w(e,t,s,_,y,w){const f=(0,r.up)("count-down"),v=(0,r.up)("AchievementCard"),$=(0,r.up)("Check"),q=(0,r.up)("Note"),x=(0,r.up)("iq-card");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("div",o,[y.week&&y.authorized?((0,r.wg)(),(0,r.j4)(f,{key:0,week:y.week,timer_type:"audit_timer"},null,8,["week"])):(0,r.kq)("",!0),(0,r.Wm)(x,{class:"iq-card"},{default:(0,r.w5)((()=>[(0,r._)("div",i,[y.mark&&y.week?((0,r.wg)(),(0,r.iD)("h3",n,(0,a.zw)(y.mark.user.name)+" - الأسبوع "+(0,a.zw)(y.week.title),1)):(0,r.kq)("",!0)]),(0,r._)("div",d,[y.mark_for_audit?((0,r.wg)(),(0,r.iD)("span",{key:0,class:(0,a.C_)(`ms-2 rounded badge text-white ${w.statusClass(y.mark_for_audit.status)}`)},(0,a.zw)(y.audit_status[y.mark_for_audit.status]),3)):(0,r.kq)("",!0)]),(0,r._)("div",c,[y.mark?((0,r.wg)(),(0,r.j4)(v,{key:0,mark:y.mark,group:y.group},null,8,["mark","group"])):(0,r.kq)("",!0),(0,r._)("div",u,[Object.keys(y.theses).length>0?((0,r.wg)(),(0,r.j4)($,{key:0,theses:y.theses},null,8,["theses"])):((0,r.wg)(),(0,r.iD)("div",l," لا يوجد انجاز "))]),(0,r._)("div",m,[!y.expired&&y.authorized?((0,r.wg)(),(0,r.iD)("div",p,[(0,r._)("button",{class:"btn btn-primary ms-1 me-1",onClick:t[0]||(t[0]=e=>w.updateStatus("acceptable"))},"مقبول"),(0,r._)("button",{class:"btn btn-danger ms-1 me-1",onClick:t[1]||(t[1]=e=>w.updateStatus("unacceptable"))},"مرفوض"),y.msg?((0,r.wg)(),(0,r.iD)("div",h,(0,a.zw)(y.msg),1)):(0,r.kq)("",!0)])):(0,r.kq)("",!0),y.mark_for_audit?((0,r.wg)(),(0,r.j4)(q,{key:1})):(0,r.kq)("",!0),(0,r._)("div",g,[(0,r._)("div",k,[(0,r._)("a",{role:"button",onClick:t[2]||(t[2]=t=>e.$router.go(-1)),class:"d-block mt-3 mb-3 w-75 mx-auto"},b)])])])])])),_:1})])])}s(278),s(70560);var f=s(74615),v=s(16319),$=s(26667),q=s(49963),x=s(79885);const C=e=>((0,r.dD)("data-v-21bdfcf4"),e=e(),(0,r.Cn)(),e),D={class:"col-12"},Z={class:"card"},A=C((()=>(0,r._)("div",{class:"card-header",style:{background:"#cae0cd"}},[(0,r._)("h4",{class:"card-title"}," ملاحظات حول الانجاز ")],-1))),F={class:"card-content"},z={class:"card-body"},O={class:"row rounded-lg overflow-hidden shadow"},E={class:"col-12 px-0"},L={key:0,class:"px-4 py-5 chat-box bg-white",id:"notes_container"},N={class:"media-body ml-3"},S={key:0,class:"font-weight-bold"},j={class:"text-small mb-0 text-muted"},M={class:"small text-muted"},T={key:1,class:"col-sm-12 text-center"},U=C((()=>(0,r._)("img",{src:x,alt:"loader",style:{height:"100px"}},null,-1))),I=[U],H={class:"input-group"},R=C((()=>(0,r._)("div",{class:"input-group-append m-auto"},[(0,r._)("button",{id:"button-addon2",type:"submit",class:"btn btn-link"},[(0,r._)("span",{class:"display-5 text-dark material-symbols-outlined"}," send ")])],-1))),K={key:0,style:{color:"red"}};function P(e,t,s,o,i,n){const d=(0,r.up)("base-avatar"),c=(0,r.up)("iq-card");return(0,r.wg)(),(0,r.j4)(c,{"body-class":"p-0"},{body:(0,r.w5)((()=>[(0,r._)("div",D,[(0,r._)("div",Z,[A,(0,r._)("div",F,[(0,r._)("div",z,[(0,r._)("div",O,[(0,r._)("div",E,[i.notes?((0,r.wg)(),(0,r.iD)("div",L,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(i.notes,(t=>((0,r.wg)(),(0,r.iD)("div",{key:t.id,class:(0,a.C_)(["media w-auto mb-3",[t.from_id==n.user.id?"ml-auto":"ltrDirection"]])},[t.from_id!=n.user.id?((0,r.wg)(),(0,r.j4)(d,{key:0,profileImg:t.from.user_profile.profile_picture,profile_id:t.from.user_profile.id,title:t.from.name,gender:t.from.gender,avatarClass:"rounded-circle avatar-40",width:"50"},null,8,["profileImg","profile_id","title","gender"])):(0,r.kq)("",!0),(0,r._)("div",N,[(0,r._)("div",{class:(0,a.C_)(["rounded py-2 px-3 mb-2",[t.from_id==n.user.id?"bg-sender":"bg-recipient"]])},[t.from_id!=n.user.id?((0,r.wg)(),(0,r.iD)("small",S,(0,a.zw)(t.from.name),1)):(0,r.kq)("",!0),(0,r._)("p",j,(0,a.zw)(t.body),1)],2),(0,r._)("p",M,(0,a.zw)(e.formatFullDate(t.created_at)),1)])],2)))),128))])):(0,r.kq)("",!0),i.loader?((0,r.wg)(),(0,r.iD)("div",T,I)):(0,r.kq)("",!0),(0,r._)("form",{onSubmit:t[1]||(t[1]=(0,q.iM)((e=>n.submitNote()),["prevent"])),class:"mt-2"},[(0,r._)("div",H,[R,(0,r.wy)((0,r._)("input",{type:"text",placeholder:"اكتب ملاحظة","aria-describedby":"button-addon2",class:"border-bottom form-control rounded-0 border-0 py-4","onUpdate:modelValue":t[0]||(t[0]=e=>o.v$.noteForm.body.$model=e)},null,512),[[q.nr,o.v$.noteForm.body.$model]]),o.v$.noteForm.body.$invalid?((0,r.wg)(),(0,r.iD)("small",K," الملاحظة مطلوبة ")):(0,r.kq)("",!0)])],32)])])])])])])])),_:1})}var V=s(43144),W=s(5705),Y=s(10760),B=s(94268),G=s(8209),J={name:"Audit Notes",setup(){return{v$:(0,W.ZP)()}},async created(){this.notes=await B.Z.getNotes(this.noteForm.mark_for_audit_id)},data(){return{notes:null,loader:!1,noteForm:{body:"",mark_for_audit_id:this.$route.params.mark_for_audit}}},validations(){return{noteForm:{body:{required:Y.C1}}}},methods:(0,V.Z)((0,V.Z)({},G.Z),{},{async submitNote(){if(this.v$.$touch(),!this.v$.noteForm.$invalid){this.loader=!0;try{const e=await B.Z.addNote(this.noteForm);this.loader=!1,this.notes.push(e),this.scrollToEnd(),this.noteForm.body="",this.v$.noteForm.$reset()}catch(e){console.log(e)}}},scrollToEnd:function(){var e=this.$el.querySelector("#notes_container");console.log("🚀 ~ file: Note.vue:137 ~ container:",e),e.scrollTop=e.scrollHeight}}),computed:{user(){return this.$store.getters.getUser}}},Q=s(83744);const X=(0,Q.Z)(J,[["render",P],["__scopeId","data-v-21bdfcf4"]]);var ee=X,te=s(49579),se={name:"Audit Mark",async created(){try{const e=await B.Z.markForAudit(this.$route.params.mark_for_audit);this.mark_for_audit=e.mark_for_audit,this.mark=e.mark_for_audit.mark,this.theses=e.theses.reduce(((e,t)=>{const s=e[t.book.name]||[];return s["title"]=t.book.name,s.push(t),e[t.book.name]=s,e}),{}),this.group=e.group,this.week=e.week,this.expired=this.time<0,this.authorized=e.authorized}catch(e){console.log(e)}},components:{Check:v.Z,AchievementCard:f.Z,CountDown:$.Z,Note:ee},data(){return{theses:[],group:null,week:null,expired:!0,mark:null,authorized:!1,mark_for_audit:null,audit_status:{acceptable:"مقبول",unacceptable:"مرفوض",not_audited:"لم يتم تدقيقه"},msg:""}},methods:{statusClass(e){switch(e){case"acceptable":return"bg-primary";case"unacceptable":return"bg-danger";default:return"bg-dark"}},async updateStatus(e){await B.Z.updateMarkForAuditStatus(e,this.$route.params.mark_for_audit);this.mark_for_audit.status=e,this.msg="تم التدقيق"}},computed:{user(){return this.$store.getters.getUser},isAdvisor(){return te.Z.hasRole(this.user,"advisor")},time(){const e=(new Date).toLocaleString("en-US",{timeZone:"Asia/Riyadh"}),t=new Date(this.week.audit_timer),s=new Date(e);return this.isAdvisor?t.getTime()+936e5-s:t-s}}};const re=(0,Q.Z)(se,[["render",w]]);var ae=re}}]);
//# sourceMappingURL=455.8ea11833.js.map