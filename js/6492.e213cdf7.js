"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[6492],{19057:function(e,s,t){var i=t(66252),o=t(24150);class r{async getUserBooks(e){try{const s=await o.hi.get(`user-books/show/${e}`);return s.data.data}catch(s){return s}}async getAllFree(e,s){try{const t=await o.hi.get(`user-books/free-books/${s}/${e}`);return t.data.data}catch(t){return t}}async eligibleToWriteThesis(e){try{const s=await o.hi.get(`user-books/eligible-to-write-thesis/${e}`);return s.data.data}catch(s){return s}}async laterBooks(e){try{const s=await o.hi.get(`user-books/later-books/${e}`);return s.data.data}catch(s){return s}}async deleteForLeater(e){try{const s=await o.hi.get(`user-books/delete-for-later-book/${e}`);return s.data.data}catch(s){return s}}async saveBookForLater(e){try{const s=await o.hi.patch(`/user-books/${e}/save-for-later`);return s.data}catch(s){(0,i.S3)(s)}}}s.Z=new r},41251:function(e,s,t){t.d(s,{Z:function(){return ye}});t(76265);var i=t(66252),o=t(49963),r=t(3577);const a=e=>((0,i.dD)("data-v-60e63b48"),e=e(),(0,i.Cn)(),e),h={class:"d-flex align-items-center w-100 row"},l={class:"row"},n=a((()=>(0,i._)("div",{class:"form-group"},[(0,i._)("h5",{class:"form-label"},"نوع الأطروحة")],-1))),d={class:"form-group"},c=a((()=>(0,i._)("option",{value:""},"اختر نوع الأطروحة",-1))),m=a((()=>(0,i._)("option",{value:"read"},"قراءة",-1))),g=a((()=>(0,i._)("option",{value:"readAndWrite"},"كتابة أطروحة",-1))),p=["disabled"],u={key:0},y=a((()=>(0,i._)("small",null," (مغلق اليوم) ",-1))),k=["disabled"],b={key:0},v=a((()=>(0,i._)("small",null," (مغلق اليوم) ",-1))),_={key:0,class:"row mt-2"},f={class:"form-group"},w={key:1,class:"row"},T=a((()=>(0,i._)("span",{class:"material-symbols-outlined md-18"}," refresh ",-1))),F={key:0,style:{color:"red"}},$={class:"form-group col-6"},D=a((()=>(0,i._)("option",{value:""},"صفحة البداية",-1))),O=["value"],q={key:0,class:"help-block"},E={key:0,style:{color:"red"}},x={key:1,style:{color:"red"}},S={class:"form-group col-6"},A=a((()=>(0,i._)("option",{value:""},"صفحة النهاية",-1))),I=["value"],M={key:0,class:"help-block"},C={key:0,style:{color:"red"}},B={key:1,style:{color:"red"}},P={key:2,class:"form-group"},U=a((()=>(0,i._)("label",{class:"form-label",for:"thesisBody"},"الأطروحة",-1))),Z={style:{direction:"rtl"}},H=a((()=>(0,i._)("span",null," - ",-1))),W={key:0,style:{color:"red"},class:"text-center"},z=a((()=>(0,i._)("span",{class:"material-symbols-outlined font-small"},"error",-1))),j={key:1,style:{color:"green"}},L=a((()=>(0,i._)("span",{class:"material-symbols-outlined font-small"},"check_circle",-1))),V={key:0,class:"help-block"},N={key:0,style:{color:"red"}},R={key:3,class:"form-group"},Y=a((()=>(0,i._)("label",{class:"form-label",for:"customFile"}," اضافة اقتباس",-1))),K={key:0,class:"help-block"},G={key:0,style:{color:"red"}},J={key:1,class:"help-block"},Q={style:{color:"red"}},X=a((()=>(0,i._)("small",{class:"text-center mt-2 text-danger"}," ⚠️ إن الاقتباسات المصورة لا يتم الاحتفاظ بها على المنصة. لأجل ذلك نحثك على كتابة الأطروحة أو التلخيص لتحفظ أفكارك التي انتفعت بها من الكتاب.",-1))),ee=a((()=>(0,i._)("hr",null,null,-1))),se={key:4,class:"text-danger text-center"},te={key:5,class:"text-danger text-center"},ie={key:6,class:"col-sm-12 text-center"},oe=["src"],re=["disabled"];function ae(e,s,a,ae,he,le){const ne=(0,i.up)("ImagePreviewer");return(0,i.wg)(),(0,i.iD)("form",{onSubmit:s[7]||(s[7]=(0,o.iM)(((...e)=>le.submit&&le.submit(...e)),["prevent"]))},[(0,i._)("div",h,[(0,i._)("div",l,[n,(0,i._)("div",d,[(0,i.wy)((0,i._)("select",{class:"form-select w-100",name:"type_of_thesis",id:"type_of_thesis","onUpdate:modelValue":s[0]||(s[0]=e=>ae.v$.thesisForm.typeOfThesis.$model=e),onChange:s[1]||(s[1]=e=>le.changeTypeOfThesis(e.target.options[e.target.options.selectedIndex].value))},[c,m,g,(0,i._)("option",{value:"screenshots",disabled:he.screenshotsDisabled},[(0,i.Uk)(" اقتباسات "),he.screenshotsDisabled?((0,i.wg)(),(0,i.iD)("span",u,[(0,i.Uk)(" - "),y])):(0,i.kq)("",!0)],8,p),(0,i._)("option",{value:"screenshotsAndWrite",disabled:he.screenshotsDisabled},[(0,i.Uk)(" كتابة واقتباسات "),he.screenshotsDisabled?((0,i.wg)(),(0,i.iD)("span",b,[(0,i.Uk)(" - "),v])):(0,i.kq)("",!0)],8,k)],544),[[o.bM,ae.v$.thesisForm.typeOfThesis.$model]])])]),he.showPages?((0,i.wg)(),(0,i.iD)("div",_,[(0,i._)("div",f,[(0,i._)("h5",{class:(0,r.C_)(["form-label",{"text-primary":0===le.pages.length&&!he.startOver}])},(0,r.zw)(0!==le.pages.length||he.startOver?"الصفحات":"لقد أنهيت الكتاب"),3)])])):(0,i.kq)("",!0),he.showPages?((0,i.wg)(),(0,i.iD)("div",w,[0!==le.pages.length||he.startOver?((0,i.wg)(),(0,i.iD)(i.HY,{key:1},[le.numberOfPages<3?((0,i.wg)(),(0,i.iD)("small",F,"* الحد الأدنى 3 صفحات")):(0,i.kq)("",!0),(0,i._)("div",$,[(0,i.wy)((0,i._)("select",{class:"form-select","data-trigger":"",name:"start_page",id:"start_page","onUpdate:modelValue":s[3]||(s[3]=e=>ae.v$.thesisForm.start_page.$model=e)},[D,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(le.pages,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,r.zw)(e),9,O)))),128))],512),[[o.bM,ae.v$.thesisForm.start_page.$model]]),ae.v$.thesisForm.start_page.$error?((0,i.wg)(),(0,i.iD)("div",q,[ae.v$.thesisForm.start_page.required.$invalid?((0,i.wg)(),(0,i.iD)("small",E,"الرجاء اختيار صفحة البداية")):(0,i.kq)("",!0),!ae.v$.thesisForm.start_page.required.$invalid&&ae.v$.thesisForm.start_page.between.$invalid?((0,i.wg)(),(0,i.iD)("small",x,"البداية يجب ان تكون اقل من النهاية")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)]),(0,i._)("div",S,[(0,i.wy)((0,i._)("select",{class:"form-select","data-trigger":"",name:"end_page",id:"end_page","onUpdate:modelValue":s[4]||(s[4]=e=>ae.v$.thesisForm.end_page.$model=e)},[A,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(le.bookPagesEnd,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,r.zw)(e),9,I)))),128))],512),[[o.bM,ae.v$.thesisForm.end_page.$model]]),ae.v$.thesisForm.end_page.$error?((0,i.wg)(),(0,i.iD)("div",M,[ae.v$.thesisForm.end_page.required.$invalid?((0,i.wg)(),(0,i.iD)("small",C,"الرجاء اختيار صفحة النهاية")):(0,i.kq)("",!0),!ae.v$.thesisForm.end_page.required.$invalid&&ae.v$.thesisForm.end_page.between.$invalid?((0,i.wg)(),(0,i.iD)("small",B,"النهاية يجب ان تكون اكبر من البداية")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])],64)):((0,i.wg)(),(0,i.iD)("button",{key:0,class:"btn btn-primary me-2 d-flex align-content-center justify-content-center",onClick:s[2]||(s[2]=(0,o.iM)(((...e)=>le.startBookOver&&le.startBookOver(...e)),["prevent"]))},[T,(0,i.Uk)(" إعادة قراءة الكتاب ")]))])):(0,i.kq)("",!0),he.thesis?((0,i.wg)(),(0,i.iD)("div",P,[U,(0,i.wy)((0,i._)("textarea",{rows:"5",placeholder:"... اكتب أطروحتك",class:"rounded form-control",id:"thesisBody",name:"thesisBody","onUpdate:modelValue":s[5]||(s[5]=e=>ae.v$.thesisForm.body.$model=e),style:{direction:"rtl"}},null,512),[[o.nr,ae.v$.thesisForm.body.$model,void 0,{trim:!0}]]),(0,i._)("p",Z,[(0,i._)("span",null,(0,r.zw)(ae.v$.thesisForm.body.$model.length)+"/400 حرف",1),H,ae.v$.thesisForm.body.$model.length<400?((0,i.wg)(),(0,i.iD)("span",W,[(0,i.Uk)("أطروحة غير شاملة "),z])):((0,i.wg)(),(0,i.iD)("span",j,[(0,i.Uk)("أطروحة شاملة "),L]))]),ae.v$.thesisForm.body.$error?((0,i.wg)(),(0,i.iD)("div",V,[ae.v$.thesisForm.body.requiredIf.$invalid?((0,i.wg)(),(0,i.iD)("small",N,"الرجاء ادخال الأطروحة")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])):(0,i.kq)("",!0),he.screenshots?((0,i.wg)(),(0,i.iD)("div",R,[Y,(0,i._)("input",{class:"form-control",type:"file",id:"customFile",multiple:"",accept:"image/jpeg, image/png, image/jpg, image/gif, image/svg",ref:"screenShots",onChange:s[6]||(s[6]=(...e)=>le.previewImages&&le.previewImages(...e))},null,544),ae.v$.thesisForm.screenShots.$error?((0,i.wg)(),(0,i.iD)("div",K,[ae.v$.thesisForm.screenShots.requiredIf.$invalid?((0,i.wg)(),(0,i.iD)("small",G,"الرجاء ادخال اقتباس واحد على الاقل")):(0,i.kq)("",!0)])):(0,i.kq)("",!0),he.filesLimitError?((0,i.wg)(),(0,i.iD)("div",J,[(0,i._)("small",Q,(0,r.zw)(he.filesLimitError),1)])):(0,i.kq)("",!0),he.thesisForm.screenShots.length?((0,i.wg)(),(0,i.j4)(ne,{key:2,media:he.thesisForm.screenShots,onRemoveMedia:le.removeImage,ref:"imagePreviewer"},null,8,["media","onRemoveMedia"])):(0,i.kq)("",!0),X])):(0,i.kq)("",!0),ee,he.errorMessage?((0,i.wg)(),(0,i.iD)("small",se,(0,r.zw)(he.errorMessage),1)):(0,i.kq)("",!0),he.mediaNoteText&&a.thesisToEdit?((0,i.wg)(),(0,i.iD)("small",te,(0,r.zw)(he.mediaNoteText),1)):(0,i.kq)("",!0),he.loader?((0,i.wg)(),(0,i.iD)("div",ie,[(0,i._)("img",{src:t(79885),alt:"loader",style:{height:"100px"}},null,8,oe)])):(0,i.kq)("",!0),he.loader?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:7,type:"submit",class:"btn btn-primary d-block mt-3",disabled:ae.v$.thesisForm.$invalid}," إضافة ",8,re))])],32)}var he=t(43144),le=(t(70560),t(32320),t(5705)),ne=t(10760),de=t(27522),ce=t(53186),me=t(8209),ge={name:"CreateThesis",components:{ImagePreviewer:ce.Z},props:{book:{type:Object,default:null},lastThesis:{type:Object,default:null},thesisToEdit:{type:Object,default:null}},setup(){return{v$:(0,le.ZP)()}},data(){return{thesis:!1,screenshots:!1,showPages:!1,loader:!1,startOver:!1,thesisForm:{typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[],type:"thesis",book_id:null,u_comment_id:null},mediaNoteText:"",errorMessage:"",filesLimitError:"",screenshotsDisabled:!1,currentTime:new Date,timer:null}},mounted(){this.timer=setInterval((()=>{this.currentTime=new Date}),1e3)},beforeUnmount(){clearInterval(this.timer)},computed:{numberOfPages(){return this.thesisForm.end_page-this.thesisForm.start_page+1},successMessage(){return this.thesisToEdit?"تم تعديل الأطروحة بنجاح":"تم إضافة الأطروحة بنجاح"},pages(){let e=[],s=null;var t;this.book.userBooks.length&&"in progress"===this.book.userBooks[0].status?s=this.lastThesis?(null===(t=this.lastThesis)||void 0===t?void 0:t.end_page)+1:this.book.start_page:(!this.book.userBooks.length&&!this.lastThesis||this.book.userBooks.length&&"later"===this.book.userBooks[0].status)&&(s=this.book.start_page);if(this.thesisToEdit&&(s=this.book.start_page),null===s&&!this.startOver)return[];null===s&&this.startOver&&(s=this.book.start_page);for(let i=s;i<=this.book.end_page;i++)e.push(i);return e},bookPagesEnd(){return this.pages.filter((e=>e>this.thesisForm.start_page))},isTimeValid(){const e=me.Z.convertTZ(this.currentTime,"Asia/Riyadh"),s=e.getDay(),t=e.getHours();e.getMinutes();return 6===s&&t>=21}},watch:{book(){this.thesisForm.book_id=this.book.id}},created(){if(this.thesisToEdit){var e;this.thesisForm.u_comment_id=parseInt(this.thesisToEdit.id),this.thesisForm.body=this.thesisToEdit.body?this.thesisToEdit.body:"",this.thesisForm.start_page=this.thesisToEdit.thesis.start_page,this.thesisForm.end_page=this.thesisToEdit.thesis.end_page,this.thesisForm.screenShots.old=null!==(e=this.thesisToEdit.media)&&void 0!==e?e:[],this.showPages=!0,!this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||!this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0?this.thesisForm.typeOfThesis="read":(this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0)&&(this.thesisForm.typeOfThesis="readAndWrite"),this.changeTypeOfThesis(this.thesisForm.typeOfThesis);const s=this.checkThesisHasMedia(this.thesisToEdit);this.mediaNoteText=s>0?`ملاحظة: سيتم حذف الصور الموجودين بعد تعديل الأطروحة وعددهم: ${s}`:""}else{var s;this.thesisForm.book_id=null===(s=this.book)||void 0===s?void 0:s.id}},methods:{showAddThesis(){this.thesis=!0,this.screenshots=!1},showAddScreenshots(){this.screenshots=!0,this.thesis=!1},noThesisAndScreenshots(){this.thesis=!1,this.screenshots=!1},thesisAndScreenshots(){this.thesis=!0,this.screenshots=!0},changeTypeOfThesis(e){this.showPages=!0,"read"==e?this.noThesisAndScreenshots():"readAndWrite"==e?this.showAddThesis():"screenshots"==e?this.showAddScreenshots():"screenshotsAndWrite"==e?this.thesisAndScreenshots():(this.showPages=!1,this.noThesisAndScreenshots())},previewImages(e){const{files:s}=e.target;s.length>5?this.filesLimitError="لا يمكنك رفع أكثر من 5 اقتباسات":(this.filesLimitError="",this.thesisForm.screenShots=s)},removeImage(e){const s=[...this.thesisForm.screenShots];s.splice(e,1),this.thesisForm.screenShots=s,0==this.thesisForm.screenShots.length&&(this.$refs.screenShots.value=null)},async submit(){if(this.v$.$touch(),!this.v$.thesisForm.$invalid&&this.numberOfPages>=3){this.loader=!0;try{let e;if(this.updateThesisForm(),e=this.thesisToEdit?await de.Z.update(this.thesisForm):await de.Z.create(this.thesisForm),200!==e.statusCode)throw e.data;me.Z.toggleToast(this.successMessage,"success"),this.thesisToEdit?setTimeout((()=>{location.reload()}),1800):(this.$emit("addThesis",e.data),this.thesisForm=(0,he.Z)((0,he.Z)({},this.thesisForm),{},{typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[]}),this.v$.thesisForm.$reset(),this.changeTypeOfThesis(""),setTimeout((()=>{this.$emit("closeModel")}),2e3))}catch(e){me.Z.toggleErrorToast(),console.log(e)}finally{this.loader=!1}}else this.errorMessage="الرجاء ادخال جميع البيانات المطلوبة"},updateThesisForm(){"read"==this.thesisForm.typeOfThesis?(this.thesisForm.body=null,this.thesisForm.screenShots=[]):"readAndWrite"==this.thesisForm.typeOfThesis?this.thesisForm.screenShots=[]:"screenshots"==this.thesisForm.typeOfThesis&&(this.thesisForm.body=null)},startBookOver(){this.startOver=!0},checkThesisHasMedia(e){var s;let t=0;return e.media&&t++,null!==(s=e.replies)&&void 0!==s&&s.length&&e.replies.forEach((e=>{"screenshot"===e.type&&e.media&&t++})),t},informUserAboutClosingScreenShots(){if(this.isTimeValid&&!this.$cookies.get("show-closing-screenshots-alert")){const e=this.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg"},buttonsStyling:!1});let s="<p class='text-center'>بسبب كثرة القراء الذين يدخلون تصويت القراءة الآن</p>";s+="<p class='text-center'>لا يتحمل السيرفر <b class='text-danger'>تحميل الصور</b></p>",s+="<p class='text-center'>فضلا ادخل أطروحتك أو اقتباساتك بشكل <b>مكتوب</b></p>",s+="<p class='text-center'>يتاح رفع الصور <span class='text-primary'><b>من الأحد إلى الساعة التاسعة من يوم السبت</b></span> أسبوعياً</p>",e.fire({title:"لا يمكنك وضع اقتباسات مؤقتًا",html:s,showCancelButton:!1,confirmButtonText:"حسنًا",icon:"warning",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then((e=>{e.isConfirmed&&this.$cookies.set("show-closing-screenshots-alert",!0,"1d")}))}}},validations(){return{thesisForm:{typeOfThesis:{required:ne.C1},start_page:{required:ne.C1,between:e=>parseInt(e)<parseInt(this.thesisForm.end_page)},end_page:{required:ne.C1,between:e=>parseInt(e)>parseInt(this.thesisForm.start_page)},body:{requiredIf:(0,ne.CF)((()=>"readAndWrite"==this.thesisForm.typeOfThesis||"screenshotsAndWrite"==this.thesisForm.typeOfThesis))},screenShots:{requiredIf:(0,ne.CF)((()=>"screenshots"==this.thesisForm.typeOfThesis||"screenshotsAndWrite"==this.thesisForm.typeOfThesis))}}}}},pe=t(83744);const ue=(0,pe.Z)(ge,[["render",ae],["__scopeId","data-v-60e63b48"]]);var ye=ue},21218:function(e,s,t){e.exports=t.p+"img/200x200-book.5a0360f9.png"}}]);
//# sourceMappingURL=6492.e213cdf7.js.map