{"version":3,"file":"js/8469.637fbd83.js","mappings":"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","sources":["webpack://Osboha180/./src/API/services/notifications.service.js","webpack://Osboha180/./src/views/OsbohaMain/Notifications/Notification.vue","webpack://Osboha180/./src/views/OsbohaMain/Notifications/Notification.vue?d665"],"sourcesContent":["import { handleError } from \"vue\";\nimport { api } from \"../Intercepter\";\n\nclass Notifications {\n  constructor() {\n    this.prefix = \"notifications\";\n  }\n\n  /**\n   * list all Unread Notifications.\n   * @return Unread Notifications\n   */\n  async listUnreadNotification() {\n    try {\n      const response = await api.get(`${this.prefix}/un-read`);\n      return response.data.data;\n    } catch (error) {\n      handleError(error);\n    }\n  }\n  /**\n   * list all Notifications.\n   * @return Unread Notifications\n   */\n  async listAllNotification(page) {\n    try {\n      const response = await api.get(`${this.prefix}/list-all?page=${page}`);\n      return response.data.data;\n    } catch (error) {\n      handleError(error);\n    }\n  }\n  /**\n   * mark one notification as read\n   * @param notification_id\n   */\n  async markAsRead(notification_id) {\n    try {\n      const response = await api.get(\n        `${this.prefix}/mark-as-read/${notification_id}`\n      );\n      return response.data.data;\n    } catch (error) {\n      return error;\n    }\n  }\n\n  /**\n   * mark ALL notifications as read\n   * @param notification_id\n   */\n  async markAllAsRead() {\n    try {\n      const response = await api.get(`${this.prefix}/mark-all-as-read`);\n      return response.data.data;\n    } catch (error) {\n      return error;\n    }\n  }\n}\n\nexport default new Notifications();\n","<template>\n  <div class=\"row\" ref=\"listContainer\">\n    <div class=\"col-sm-12\">\n      <h4 class=\"card-title\">الاشعارات</h4>\n\n      <div class=\"col-sm-12\" v-if=\"notifications.length == 0\">\n        <iq-card class=\"iq-card\">\n          <div class=\"iq-card-body p-0\">\n            <div class=\"image-block text-center\">\n              <img\n                src=\"@/assets/images/main/no-notifications.png\"\n                class=\"img-fluid rounded w-50\"\n                alt=\"blog-img\"\n              />\n            </div>\n\n            <h4 class=\"text-center mt-3 mb-3\">لا يوجد اشعارات</h4>\n          </div>\n        </iq-card>\n      </div>\n\n      <span\n        role=\"button\"\n        class=\"btn btn-primary mb-3\"\n        v-if=\"unreadCount > 0\"\n        style=\"direction: rtl !important\"\n        @click=\"markAllAsRead()\"\n      >\n        <i role=\"button\" class=\"material-symbols-outlined align-middle\">\n          done\n        </i>\n\n        تحديد قراءة الكل\n      </span>\n    </div>\n    <div\n      class=\"col-sm-12\"\n      v-for=\"(notification, index) in notifications\"\n      :key=\"index\"\n    >\n      <iq-card\n        :class=\"[seenClass(notification.read_at), notification.data.type]\"\n      >\n        <template v-slot:body>\n          <div class=\"notification-list m-0 p-0\">\n            <div class=\"d-flex align-items-center justify-content-between\">\n              <base-avatar\n                :profileImg=\"\n                  notification.data.sender.user_profile.profile_picture\n                \"\n                :profile_id=\"notification.data.sender.user_profile.id\"\n                :title=\"notification.data.sender.name\"\n                :gender=\"notification.data.sender.gender\"\n                avatarClass=\"rounded-circle avatar-40\"\n              />\n              <div class=\"w-100\">\n                <div class=\"d-flex justify-content-between\">\n                  <div class=\"ms-3\">\n                    <h6\n                      style=\"direction: rtl\"\n                      :class=\"{\n                        'text-white': isWhite(notification),\n                      }\"\n                    >\n                      {{ notification.data.message }}\n                    </h6>\n                    <tooltip\n                      tag=\"span\"\n                      class=\"text-muted small\"\n                      :class=\"{\n                        'text-white-50': isWhite(notification),\n                      }\"\n                      tooltipPlacement=\"bottom\"\n                      data-bs-toggle=\"tooltip\"\n                      :title=\"formatFullDate(notification.created_at)\"\n                      >{{ formatDateToWritten(notification.created_at) }}\n                    </tooltip>\n                  </div>\n\n                  <div class=\"d-flex align-items-center\">\n                    <span\n                      role=\"button\"\n                      class=\"me-1\"\n                      :class=\"{\n                        'text-white': isWhite(notification),\n                      }\"\n                      @click.prevent=\"\n                        sendToPage(notification.data.path, notification.id)\n                      \"\n                      v-if=\"notification.data.path\"\n                    >\n                      عرض\n                    </span>\n                    <i\n                      role=\"button\"\n                      class=\"material-symbols-outlined md-18 me-3\"\n                      :class=\"{\n                        'text-white': isWhite(notification),\n                      }\"\n                      v-if=\"!notification.read_at\"\n                      @click=\"markAsRead(notification.id)\"\n                    >\n                      done\n                    </i>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </template>\n      </iq-card>\n    </div>\n  </div>\n</template>\n<script>\nimport helper from \"@/utilities/helper\";\nimport notificationsServices from \"@/API/services/notifications.service\";\n\nexport default {\n  name: \"Notification\",\n  created() {\n    this.loadNotifications();\n  },\n  async mounted() {\n    window.addEventListener(\"scroll\", this.handleScroll);\n  },\n  beforeUnmount() {\n    window.removeEventListener(\"scroll\", this.handleScroll);\n  },\n  data() {\n    return {\n      notifications: [],\n      notifications_route: [],\n      notification_route: {\n        friends_requests: \"user.friendsRequests\",\n      },\n\n      page: 1,\n      totalPages: 1,\n      loading: false,\n      pendingRequest: false,\n      hasMore: true,\n      unRead: false,\n    };\n  },\n  computed: {\n    hasMoreToLoad() {\n      return this.page <= this.totalPages && this.hasMore;\n    },\n    unreadCount() {\n      return this.notifications.length;\n    },\n  },\n  methods: {\n    ...helper,\n    async loadNotifications() {\n      if (this.pendingRequest) {\n        return;\n      }\n\n      this.pendingRequest = true;\n      this.loading = true;\n      try {\n        let response = await notificationsServices.listAllNotification(\n          this.page,\n        );\n        this.notifications = response.data;\n        console.log(response.data[0].data.type);\n        this.checkUnread();\n\n        this.totalPages = response.data?.last_page ?? 1;\n        this.page++;\n\n        if (response.statusCode === 200 && !response.data) {\n          this.hasMore = false;\n          return;\n        }\n      } catch (error) {\n        console.log(error);\n        // helper.toggleToast(\n        //   \"حدث خطأ أثناء تحميل الإشعارات, حاول مرة أخرى\",\n        //   \"error\"\n        // );\n      } finally {\n        this.loading = false;\n        this.pendingRequest = false;\n      }\n    },\n    /**\n     * Check if the user has scrolled to the bottom of the page\n     * @returns {boolean}\n     */\n    isAtBottomOfPage() {\n      const containerRect = this.$refs.listContainer.getBoundingClientRect();\n      const containerBottom = containerRect.bottom;\n      const windowHeight = window.innerHeight;\n      return containerBottom <= windowHeight;\n    },\n    /*\n     * Load more posts when the user scrolls to the bottom of the page\n     */\n    handleScroll() {\n      if (this.hasMoreToLoad && this.isAtBottomOfPage()) {\n        this.loadNotifications();\n      }\n    },\n\n    /**\n     * return bg color class.\n     *  @param  read_at\n     * @return class\n     */\n    seenClass(read_at) {\n      if (read_at) {\n        return \"seen\";\n      } else {\n        return \"un-seen\";\n      }\n    },\n    /**\n     * mark one notification as read.\n     *  @param  notification_id\n     */\n    async markAsRead(notification_id) {\n      const response = await notificationsServices.markAsRead(notification_id);\n      this.notifications = response.data;\n      this.checkUnread();\n      if (this.unreadCount > 0) {\n        this.$store.commit(\"SET_UNREAD_NOTIFICATIONS\", this.unreadCount - 1);\n      }\n    },\n\n    /**\n     * mark ALL notification as read.\n     */\n    async markAllAsRead() {\n      const response = await notificationsServices.markAllAsRead();\n      this.notifications = response.data;\n      this.checkUnread();\n      this.$store.commit(\"SET_UNREAD_NOTIFICATIONS\", 0);\n    },\n    checkUnread() {\n      function there_is_unread(notification) {\n        return notification.read_at === null;\n      }\n      // check unread\n      if (this.notifications.find(there_is_unread)) {\n        this.unRead = true;\n      }\n    },\n\n    sendToPage(path, id) {\n      if (path) {\n        this.$router.push({ path });\n      }\n      this.markAsRead(id);\n    },\n\n    isWhite(notification) {\n      return (\n        notification.data.type === \"announcement\" ||\n        notification.data.type === \"support\"\n      );\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.seen:not(.announcement, .support) {\n  --bs-bg-opacity: 1;\n  background-color: white;\n}\n\n.un-seen:not(.announcement, .support) {\n  --bs-bg-opacity: 1;\n  background-color: #e2e2e2;\n}\n\n.announcement {\n  $primary: #1f662b;\n  $secondary: rgba($primary, 0.9);\n  --bs-bg-opacity: 1;\n  background-color: $primary;\n\n  &.seen {\n    background-color: $secondary;\n  }\n}\n\n.support {\n  $primary: #831018;\n  $secondary: rgba($primary, 0.9);\n  --bs-bg-opacity: 1;\n  background-color: $primary;\n\n  &.seen {\n    background-color: $secondary;\n  }\n}\n</style>\n","import { render } from \"./Notification.vue?vue&type=template&id=266538c2&scoped=true\"\nimport script from \"./Notification.vue?vue&type=script&lang=js\"\nexport * from \"./Notification.vue?vue&type=script&lang=js\"\n\nimport \"./Notification.vue?vue&type=style&index=0&id=266538c2&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-266538c2\"]])\n\nexport default __exports__"],"names":["Notifications","constructor","this","prefix","listUnreadNotification","response","api","get","data","error","handleError","listAllNotification","page","markAsRead","notification_id","markAllAsRead","class","ref","_createElementVNode","src","_imports_0","alt","role","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","$data","notifications","length","_hoisted_4","_createVNode","_component_iq_card","_hoisted_5","$options","unreadCount","style","onClick","_cache","$event","_hoisted_6","_Fragment","_renderList","notification","index","key","_normalizeClass","seenClass","read_at","type","body","_withCtx","_hoisted_7","_hoisted_8","_component_base_avatar","profileImg","sender","user_profile","profile_picture","profile_id","id","title","name","gender","avatarClass","_hoisted_9","_hoisted_10","_hoisted_11","isWhite","message","_component_tooltip","tag","tooltipPlacement","_ctx","formatFullDate","created_at","formatDateToWritten","_hoisted_12","path","_withModifiers","sendToPage","_hoisted_13","_hoisted_14","created","loadNotifications","mounted","window","addEventListener","handleScroll","beforeUnmount","removeEventListener","notifications_route","notification_route","friends_requests","totalPages","loading","pendingRequest","hasMore","unRead","computed","hasMoreToLoad","methods","_objectSpread","helper","_response$data$last_p","_response$data","notificationsServices","console","log","checkUnread","last_page","statusCode","isAtBottomOfPage","containerRect","$refs","listContainer","getBoundingClientRect","containerBottom","bottom","windowHeight","innerHeight","$store","commit","there_is_unread","find","$router","push","__exports__","render"],"sourceRoot":""}