"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[2020],{22658:function(t,a,e){var r=e(66252),s=e(24150),n=e(79940);class o{async createGroup(t){try{const a=await s.hi.post("/group/create",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){(0,r.S3)(a)}}async getAll(t,a){try{const e=await s.hi.get(`/group?page=${a}&name=${t}`);return await e.data}catch(e){return e}}async searchGroupByName(t){try{const a=await s.hi.get(`group/search-group-by-name/${t}`);return await a.data}catch(a){return a}}async getById(t){try{const a=await s.hi.get(`group/show/${t}`);return a.data.data}catch(a){return a}}async showBasicInfo(t){try{const a=await s.hi.get(`group/show-basic-info/${t}`);return a.data.data}catch(a){return a}}async getBooks(t){try{const a=await s.hi.get(`group/books/${t}`);return a.data.data}catch(a){(0,r.S3)(a)}}async getAllGroupExceptions(t){try{const a=await s.hi.get(`group/group-exceptions/${t}`);return a.data.data}catch(a){return a}}async exceptionsFilter(t,a){try{const e=await s.hi.get(`group/exceptions-filter/${t}/${a}`);return e.data.data}catch(e){return e}}async BasicMarksView(t,a){try{const e=await s.hi.get(`group/basic-mark-view/${t}/${a}`);return e.data.data}catch(e){return e}}async AllAchievements(t,a){try{const e=await s.hi.get(`group/all-achievements/${t}/${a}`);return e.data.data}catch(e){return e}}async AchievementAsPages(t,a){try{const e=await s.hi.get(`group/achievement-as-pages/${t}/${a}`);return e.data.data}catch(e){return e}}async searchForAmbassadorAchievement(t,a,e){try{const r=await s.hi.get(`group/search-for-ambassador-achievement/${t}/${a}/${e}`);return r.data.data}catch(r){return r}}async searchForAmbassador(t,a){try{const e=await s.hi.get(`group/search-for-ambassador/${t}/${a}`);return e.data.data}catch(e){return e}}async createLeaderRequest(t){try{const a=await s.hi.post("/group/create-leader-request",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){return a}}async lastLeaderRequest(t){try{const a=await s.hi.get(`group/last-leader-request/${t}`);return a.data.data}catch(a){return a}}async deleteById(t){try{return await s.hi.delete(`/group/delete/${t}`)}catch(a){return a}}async update(t){try{const a=await s.hi.post("/group/update",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){(0,r.S3)(a)}}async getGroupByType(t){try{const a=await s.hi.get(`/group/group-by-type/${t}`);return a.data.data}catch(a){return a}}async userGroups(t,a){try{const e=await s.hi.get(`/group/user-groups?page=${a}&name=${t}`);return e.data}catch(e){return e}}async statistics(t){try{const a=await s.hi.get(`group/statistics/${t}`);return a.data.data}catch(a){(0,n.F)(a,"statistics")}}async thesesAndScreensByWeek(t,a){try{const e=await s.hi.get(`group/theses-and-screens-by-week/${t}/${a}`);return e.data.data}catch(e){(0,r.S3)(e)}}async monthAchievement(t,a){try{const e=await s.hi.get(`group/month-achievement/${t}/${a}`);return e.data.data}catch(e){(0,r.S3)(e)}}async assignAdministrator(t){try{const a=await s.hi.post("/group/assign-administrator",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){(0,r.S3)(a)}}}a.Z=new o},60351:function(t,a,e){e.d(a,{So:function(){return r},Wx:function(){return n},b5:function(){return i},gg:function(){return o},jx:function(){return s}});const r={ambassador:"سفير",leader:"قائد",supervisor:"مراقب",advisor:"موجه",consultant:"مستشار",admin:"ادارة",book_quality_team:"جودة الكتب"},s={arabic:"اللغة العربية",english:"اللغة الانجليزية"},n={normal:"منهج",ramadan:"رمضان",young:"يافعين",kids:"أطفال",tafseer:"تفسير",free:"كتاب حر"},o={January:"يناير",February:"فبراير",March:"مارس",April:"ابريل",May:"مايو",June:"يونيو",July:"يوليو",August:"أغسطس",September:"سبتمبر",October:"أكتوبر",November:"نوفمبر",December:"ديسمبر"},i={"01":"يناير","02":"فبراير","03":"مارس","04":"ابريل","05":"مايو","06":"يونيو","07":"يوليو","08":"أغسطس","09":"سبتمبر",10:"أكتوبر",11:"نوفمبر",12:"ديسمبر"}},79940:function(t,a,e){e.d(a,{F:function(){return s}});e(70560);var r=e(1120);function s(t,a=""){throw console.log(`[ERROR] ${a} =>`,t.response.data),404===t.response.data.statusCode?r.Z.push({name:"NotFound"}):403===t.response.data.statusCode&&r.Z.push({name:"NotAuthorized"}),t}},92020:function(t,a,e){e.r(a),e.d(a,{default:function(){return q}});e(76265);var r=e(66252),s=e(3577),n=e(49963);const o=t=>((0,r.dD)("data-v-514965c0"),t=t(),(0,r.Cn)(),t),i={ref:"listContainer"},c={class:"row"},u={class:"col-sm-12"},d={key:0,class:"card-title"},l={key:1,class:"card-title"},h={class:"mt-3 inputs mb-3"},p=o((()=>(0,r._)("i",{class:"material-symbols-outlined"}," search ",-1))),g={key:0,class:"table-responsive"},m={id:"datatable",class:"table table-striped table-bordered"},y=o((()=>(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"اسم المجموعة"),(0,r._)("th",null,"نوع المجموعة"),(0,r._)("th",null,"عدد الاعضاء")])],-1))),w=["onClick"],b={key:1},f=o((()=>(0,r._)("span",{class:"material-symbols-outlined align-middle"}," info ",-1))),_={key:2,class:"col-sm-12 text-center"},v=["src"];function $(t,a,o,$,k,A){const C=(0,r.up)("router-link"),S=(0,r.up)("iq-card");return(0,r.wg)(),(0,r.iD)("div",i,[(0,r._)("div",c,[(0,r._)("div",u,[(0,r.Wm)(S,null,{headerTitle:(0,r.w5)((()=>[k.groups&&k.groups.length>0?((0,r.wg)(),(0,r.iD)("h4",d,"قائمة المجموعات - "+(0,s.zw)(k.groups.length),1)):((0,r.wg)(),(0,r.iD)("h4",l,"قائمة المجموعات - 0"))])),body:(0,r.w5)((()=>[(0,r._)("div",h,[p,(0,r.wy)((0,r._)("input",{type:"text",class:"form-control",placeholder:" ... ابحث عن مجموعة","onUpdate:modelValue":a[0]||(a[0]=t=>k.searchModel=t),onKeyup:a[1]||(a[1]=(...a)=>t.debouncedSearch&&t.debouncedSearch(...a))},null,544),[[n.nr,k.searchModel,void 0,{trim:!0}]])]),(0,r.Wm)(C,{class:"mb-3 btn btn-primary float-end",to:{name:"group.addGroup"}},{default:(0,r.w5)((()=>[(0,r.Uk)(" اضافة مجموعة ")])),_:1},8,["to"]),k.groups&&k.groups.length>0?((0,r.wg)(),(0,r.iD)("div",g,[(0,r._)("table",m,[y,(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(k.groups,((t,a)=>((0,r.wg)(),(0,r.iD)("tr",{key:a},[(0,r._)("td",null,[(0,r.Wm)(C,{class:"text-center",to:{name:"group.group-detail",params:{group_id:t.id}}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(t.name),1)])),_:2},1032,["to"])]),(0,r._)("td",null,(0,s.zw)(k.group_type[t.type.type]),1),(0,r._)("td",null,(0,s.zw)(t.users_count),1),(0,r._)("td",null,[(0,r._)("span",{role:"button",onClick:a=>A.groupAdministrators(t.group_administrators,t.name),class:"text-danger material-symbols-outlined ms-1 me-1"}," shield_person ",8,w)])])))),128))])])])):((0,r.wg)(),(0,r.iD)("div",b,[(0,r._)("h4",null,[(0,r.Uk)((0,s.zw)(k.emptyMessage)+" ",1),f])])),k.loading?((0,r.wg)(),(0,r.iD)("div",_,[(0,r._)("img",{src:e(79885),alt:"loader",style:{height:"100px"}},null,8,v)])):(0,r.kq)("",!0)])),_:1})])])],512)}var k=e(22658),A=e(8209),C=e(49579),S=e(9669),M=e.n(S),B=e(60351),T={name:"Groups List",created(){this.debouncedSearch=this.debounce(this.loadGroups,300)},async mounted(){this.loadGroups(),window.addEventListener("scroll",this.handleScroll)},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll),this.cancelToken.cancel()},data(){return{groups:[],group_type:{followup:"فريق متابعة",supervising:"فريق رقابة",advising:"فريق توجيه",consultation:"فريق الاستشارة",Administration:"الإدارة العليا"},searchModel:"",page:1,totalPages:1,loading:!1,pendingRequest:!1,hasMore:!0,emptyMessage:"",ARABIC_ROLES:B.So,cancelToken:M().CancelToken.source()}},methods:{async groupAdministrators(t,a){const e=this.createAdminTable(t),r=this.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg",cancelButton:"btn btn-outline-primary btn-lg ms-2"},buttonsStyling:!1});r.fire({title:a,html:e,icon:"info",confirmButtonText:"اغلاق",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}})},createAdminTable(t){let a='<table  class="table table-striped table-bordered">';return a+='<tr><th colspan="2">المسؤولين في المجموعة</th></tr>',t.forEach((function(t){a+="<tr>",a+=`<td>${B.So[t.pivot.user_type]}</td>`,a+=`<td>${t.name}</td>`,a+="</tr>"})),a+="</table>",a},async loadGroups(){if(!this.pendingRequest){""==this.searchModel&&0==this.groups.length&&(this.page=1),""!=this.searchModel&&(this.page=1,this.groups=[]),this.pendingRequest=!0,this.loading=!0,this.emptyMessage="";try{var t,a;let e;if(e=await k.Z.getAll(this.searchModel,this.page,this.cancelToken),200!==e.statusCode)return void A.Z.toggleToast("حدث خطأ أثناء تحميل المجموعات, حاول مرة أخرى","error");if(200===e.statusCode&&!e.data)return this.emptyMessage="لا يوجد مجموعات",void(this.hasMore=!1);this.groups=[...this.groups,...e.data.groups.data],this.totalPages=null!==(t=null===(a=e.data)||void 0===a?void 0:a.last_page)&&void 0!==t?t:1,this.page++}catch(e){console.log(e),A.Z.toggleToast("حدث خطأ أثناء تحميل المجموعات, حاول مرة أخرى","error")}finally{this.loading=!1,this.pendingRequest=!1}}},isAtBottomOfPage(){const t=this.$refs.listContainer.getBoundingClientRect(),a=t.bottom,e=window.innerHeight;return a>=e},handleScroll(){this.hasMoreToLoad&&this.isAtBottomOfPage()&&this.loadGroups()},debounce(t,a){let e;return function(...r){clearTimeout(e),e=setTimeout((()=>{t.apply(this,r)}),a)}}},computed:{user(){return this.$store.getters.getUser},isAdmin(){return C.Z.hasRole(this.user,"admin")},hasMoreToLoad(){return this.page<=this.totalPages&&this.hasMore}}},x=e(83744);const R=(0,x.Z)(T,[["render",$],["__scopeId","data-v-514965c0"]]);var q=R}}]);
//# sourceMappingURL=2020.89de7e7a.js.map