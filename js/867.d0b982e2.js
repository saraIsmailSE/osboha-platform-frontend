"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[867],{21295:function(t,e,s){s.d(e,{Z:function(){return x}});s(76265);var o=s(66252),n=s(3577),a=s(49963);const i={class:"row",ref:"commentsListRef"},r={key:0,class:"cols"},l={class:"text-center text-primary m-auto"},d={class:"ms-1"},m={key:1,class:"cols"},c={class:"text-center m-auto",style:{color:"red"}},p={class:"ms-1"},u={class:"card card-block card-stretch card-height blog"},h={class:"card-body"},g={key:2,class:"cols text-center"},f=["src"];function w(t,e,w,C,y,_){const v=(0,o.up)("font-awesome-icon"),b=(0,o.up)("Comment");return(0,o.wg)(),(0,o.iD)("div",i,[y.emptyMessage&&!y.comments.length?((0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("div",l,[(0,o.Wm)(v,{icon:["fas",""+(w.post.allow_comments?"pen":"circle-exclamation")],size:"sm"},null,8,["icon"]),(0,o._)("span",d,(0,n.zw)(y.emptyMessage),1)])])):(0,o.kq)("",!0),y.errorMessage?((0,o.wg)(),(0,o.iD)("div",m,[(0,o._)("div",c,[(0,o.Wm)(v,{icon:["fas","circle-exclamation"],size:"sm"}),(0,o._)("span",p,(0,n.zw)(y.errorMessage),1)])])):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(y.comments,(t=>((0,o.wg)(),(0,o.iD)("div",{class:"cols",key:t.id},[(0,o._)("div",u,[(0,o._)("div",h,[(0,o.Wm)(b,{allowComment:w.post.allow_comments,comment:t,onAddComment:_.addComment,onEditComment:_.editComment,onReactToComment:_.reactToComment},null,8,["allowComment","comment","onAddComment","onEditComment","onReactToComment"])])])])))),128)),y.loading?((0,o.wg)(),(0,o.iD)("div",g,[(0,o._)("img",{src:s(79885),alt:"loader",style:{height:"100px"}},null,8,f)])):(0,o.kq)("",!0),!_.hasMoreComments||y.loading||y.emptyMessage||y.errorMessage?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("button",{key:3,class:"w-100 p-2 bold-600 text-primary border-0 bg-transparent my-2",onClick:e[0]||(e[0]=(0,a.iM)(((...t)=>_.loadComments&&_.loadComments(...t)),["prevent"]))}," تحميل المزيد من التعليقات "))],512)}s(70560);var C=s(27522),y=s(73210),_=s(8209),v={name:"LazyLoadedComments",components:{Comment:y.Z},provide(){return{deleteComment:this.deleteComment}},inject:{incrementCommentsCount:{default:()=>{}},decrementCommentsCount:{default:()=>{}}},props:{post:{type:Object,required:!0},userId:{type:Number,default:null},loadOnCreate:{type:Boolean,default:!1}},data(){return{comments:[],page:1,totalPages:1,loading:!1,emptyMessage:"",errorMessage:""}},computed:{hasMoreComments(){return this.page<=this.totalPages}},created(){this.page=1,this.totalPages=1,this.comments=[],this.emptyMessage="",this.errorMessage="",this.loadOnCreate&&this.loadComments()},methods:{async loadComments(){if(!this.loading){this.loading=!0;try{var t;const e=await C.Z.getPostComments(this.post.id,this.page,null!==(t=this.userId)&&void 0!==t?t:"");if(200!==e.statusCode)return void _.Z.toggleToast(e.message,"error");e.data.comments?(this.comments=this.comments.concat(e.data.comments),this.totalPages=e.data.last_page,this.page++):this.emptyMessage=this.post.allow_comments?"قم بكتابة تعليقك الأول":"لا يوجد تعليقات"}catch(e){_.Z.toggleToast("حدث خطأ أثناء تحميل التعليقات، حاول مرة أخرى","error")}finally{this.loading=!1}}},findComment(t,e){for(let s=0;s<t.length;s++){if(t[s].id===e)return t[s];if(t[s].replies.length>0){const o=this.findComment(t[s].replies,e);if(o)return o}}},addComment(t,e){if(e){let s=this.findComment(this.comments,e);s.replies.push(t)}else this.comments.push(t),this.$nextTick((()=>{const t=this.$refs.commentsListRef;t.scrollTop=t.scrollHeight}));this.incrementCommentsCount(this.post.id)},deleteComment(t){for(let e=0;e<this.comments.length;e++){if(this.comments[e].id===t)return this.comments.splice(e,1),void this.decrementCommentsCount(this.post.id);if(this.comments[e].replies.length>0)for(let s=0;s<this.comments[e].replies.length;s++)if(this.comments[e].replies[s].id===t)return this.comments[e].replies.splice(s,1),void this.decrementCommentsCount(this.post.id)}},editComment(t){let e=this.findComment(this.comments,t.id);e.body=t.body,e.media=t.media},reactToComment(t,e){let s=this.findComment(this.comments,t);e?(s.reactions_count++,s.reacted_by_user=!0):(s.reactions_count--,s.reacted_by_user=!1)},resetData(){this.page=1,this.totalPages=1,this.comments=[],this.emptyMessage="",this.errorMessage="",this.loadComments()}}},b=s(83744);const k=(0,b.Z)(v,[["render",w]]);var x=k},20867:function(t,e,s){s.d(e,{Z:function(){return Rt}});var o=s(66252);const n={class:"col-sm-12"},a={class:"card card-block card-stretch card-height"},i={class:"card-body"};function r(t,e,s,r,l,d){const m=(0,o.up)("PostHeader"),c=(0,o.up)("PostBody"),p=(0,o.up)("PostMedia"),u=(0,o.up)("SupportSection"),h=(0,o.up)("PostFooter"),g=(0,o.up)("CommentsModal");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",n,[(0,o._)("div",a,[(0,o._)("div",i,[(0,o.Wm)(m,{showPin:s.showPin},null,8,["showPin"]),(0,o.Wm)(c),(0,o.Wm)(p),(0,o.Wm)(u),(0,o.Wm)(h)])])]),d.focusComment?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(g,{key:0,ref:"commentModal"},null,512))],64)}var l=s(34932),d=s(66107);const m={class:"comment-area mt-3"},c={class:"d-flex justify-content-between align-items-center flex-wrap"},p={class:"like-block position-relative d-flex align-items-center"},u=(0,o._)("hr",null,null,-1);function h(t,e,s,n,a,i){const r=(0,o.up)("TotalLikes"),l=(0,o.up)("TotalComments"),d=(0,o.up)("TotalVotes"),h=(0,o.up)("ActionButtons");return(0,o.wg)(),(0,o.iD)("div",m,[(0,o._)("div",c,[(0,o._)("div",p,[(0,o.Wm)(r),(0,o.Wm)(l),(0,o.Wm)(d)])]),u,(0,o.Wm)(h)])}s(76265);var g=s(3577),f=s(49963);const w={class:"total-comment-block"},C={class:"dropdown-menu"},y={key:0,class:"dropdown-item text-center"},_=["src"],v={key:1,class:"dropdown-item p-0 m-0 ms-2 mb-2"};function b(t,e,n,a,i,r){const l=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",w,[(0,o._)("div",{class:(0,g.C_)({dropdown:r.post.comments_count>0})},[(0,o._)("span",{class:"dropdown-toggle","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",role:"button",onMouseover:e[0]||(e[0]=(...t)=>r.getUsers&&r.getUsers(...t)),onClick:e[1]||(e[1]=(0,f.iM)(((...t)=>r.showCommentModel&&r.showCommentModel(...t)),["prevent"]))},(0,g.zw)(r.commentsCount),33),(0,o._)("div",C,[i.loading?((0,o.wg)(),(0,o.iD)("div",y,[(0,o._)("img",{src:s(79885),alt:"loader",style:{height:"50px"}},null,8,_)])):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.users,(t=>((0,o.wg)(),(0,o.j4)(l,{key:t.id,class:"dropdown-item",to:{name:"user.profile",params:{user_id:t.id}}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,g.zw)(t.name),1)])),_:2},1032,["to"])))),128)),r.moreUsersText?((0,o.wg)(),(0,o.iD)("p",v,(0,g.zw)(r.moreUsersText),1)):(0,o.kq)("",!0)])],2)])}var k=s(27522),x=s(8209),M={name:"TotalComments",inject:["post","showCommentModel"],data(){return{users:[],totalUsers:0,loading:!1}},computed:{commentsCount(){return 0==this.post.comments_count?"لا يوجد تعليقات":this.post.comments_count+" "+(this.post.comments_count<=10&&this.post.comments_count>2?"تعليقات":"تعليق")},moreUsersText(){const t=this.totalUsers-this.users.length,e=1===t?"آخر":"آخرين";return t>0?`و +${t} ${e}`:""}},methods:{async getUsers(){if(!(this.post.comments_count<=0||this.loading)){this.loading=!0;try{const t=await k.Z.getPostCommentsUsers(this.post.id);200!==t.statusCode&&x.Z.toggleToast("حدث خطأ ما, حاول مرة أخرى","error"),this.users=t.data.users,this.totalUsers=t.data.count}catch(t){x.Z.toggleToast("حدث خطأ ما, حاول مرة أخرى","error")}finally{this.loading=!1}}}}},T=s(83744);const U=(0,T.Z)(M,[["render",b]]);var P=U;const Z={class:"d-flex align-items-center"},D={class:"like-data"},q={class:"dropdown"},$={class:"text-primary","aria-haspopup":"true","aria-expanded":"false",role:"button"},R={class:"total-like-block ms-2 me-3"},z={class:"dropdown-menu"},j={key:0,class:"dropdown-item text-center"},S=["src"],W={key:1,class:"dropdown-item p-0 m-0 ms-2 mb-2"};function L(t,e,n,a,i,r){const l=(0,o.up)("font-awesome-icon"),d=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",Z,[(0,o._)("div",D,[(0,o._)("div",q,[(0,o._)("span",$,[(0,o.Wm)(l,{icon:["fas","thumbs-up"],size:"lg"})])])]),(0,o._)("div",R,[(0,o._)("div",{class:(0,g.C_)({dropdown:r.post.reactions_count>0})},[(0,o._)("span",{class:"dropdown-toggle","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",onMouseover:e[0]||(e[0]=(...t)=>r.getUsers&&r.getUsers(...t)),role:"button"},(0,g.zw)(r.post.reactions_count),33),(0,o._)("div",z,[i.loading?((0,o.wg)(),(0,o.iD)("div",j,[(0,o._)("img",{src:s(79885),alt:"loader",style:{height:"50px"}},null,8,S)])):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.users,(t=>((0,o.wg)(),(0,o.j4)(d,{key:t.id,class:"dropdown-item",to:{name:"user.profile",params:{user_id:t.id}}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,g.zw)(t.name),1)])),_:2},1032,["to"])))),128)),r.moreUsersText?((0,o.wg)(),(0,o.iD)("p",W,(0,g.zw)(r.moreUsersText),1)):(0,o.kq)("",!0)])],2)])])}var O=s(80932),H={name:"TotalLikes",inject:["post"],data(){return{reactions:[],users:[],totalUsers:0,loading:!1}},computed:{moreUsersText(){const t=this.totalUsers-this.users.length,e=1===t?"آخر":"آخرين";return t>0?`و +${t} ${e}`:""}},methods:{async getUsers(){if(!(this.post.reactions_count<=0||this.loading)){this.loading=!0;try{var t;const e=await O.Z.getPostReactionsUsers(this.post.id,null!==(t=this.$route.params.user_id)&&void 0!==t?t:"");this.users=e.data.users,this.totalUsers=e.data.count}catch(e){x.Z.toggleToast("حدث خطأ ما, حاول مرة أخرى","error")}finally{this.loading=!1}}}}};const I=(0,T.Z)(H,[["render",L]]);var B=I;const N=t=>((0,o.dD)("data-v-32c84048"),t=t(),(0,o.Cn)(),t),A={class:"d-flex justify-content-between align-items-center"},J=["disabled"],V=N((()=>(0,o._)("span",{class:"me-1 bold-600"}," إعجاب ",-1))),Y=N((()=>(0,o._)("span",{class:"me-1 bold-600"}," تعليق ",-1)));function K(t,e,s,n,a,i){const r=(0,o.up)("font-awesome-icon");return(0,o.wg)(),(0,o.iD)("div",A,[(0,o._)("button",{type:"button",class:(0,g.C_)(["btn flex-grow-1",i.post.reacted_by_user?"text-primary":"text-gray-600"]),"data-bs-toggle":"tooltip","data-bs-placement":"top",title:"إعجاب",onClick:e[0]||(e[0]=(0,f.iM)((t=>i.reactOnPost(a.selectedReaction.id)),["prevent"])),disabled:a.pendingRequest},[V,(0,o.Wm)(r,{icon:[""+(i.post.reacted_by_user?"fas":"far"),"thumbs-up"],size:"xl"},null,8,["icon"])],10,J),(0,o._)("button",{type:"button",class:"btn flex-grow-1 text-gray-600",title:"تعليق","data-bs-toggle":"tooltip","data-bs-placement":"bottom",onClick:e[1]||(e[1]=(0,f.iM)(((...t)=>i.showCommentModel&&i.showCommentModel(...t)),["prevent"]))},[Y,(0,o.Wm)(r,{icon:["far","comment"],size:"xl"})])])}var F={name:"ActionButtons",inject:{reactToPost:{default:()=>{}},showCommentModel:{required:!0},post:{required:!0}},data(){return{reactions:[],selectedReaction:{id:1,title:"إعجاب",type:"like",text_color:"#278036"},pendingRequest:!1}},computed:{},created(){},methods:{selectReaction(t){this.selectedReaction=t},async reactOnPost(t){if(!this.pendingRequest){this.pendingRequest=!0;try{const e=await O.Z.reactOnPost(this.post.id,t);if(200!==e.statusCode)return void x.Z.toggleToast("حدث خطأ ما, يرجى المحاولة لاحقاً","error");this.reactToPost(this.post.id,e.data)}catch(e){console.log("[post reaction error]",e.response),x.Z.toggleToast("حدث خطأ ما, يرجى المحاولة لاحقاً","error")}finally{this.pendingRequest=!1}}}}};const E=(0,T.Z)(F,[["render",K],["__scopeId","data-v-32c84048"]]);var G=E;const Q={key:0,class:"total-comment-block ms-3"},X={class:"dropdown-menu"},tt={key:0,class:"dropdown-item text-center"},et=["src"],st={key:1,class:"dropdown-item p-0 m-0 ms-2 mb-2"};function ot(t,e,n,a,i,r){const l=(0,o.up)("router-link");return r.post.pollOptions.length>0?((0,o.wg)(),(0,o.iD)("div",Q,[(0,o._)("div",{class:(0,g.C_)({dropdown:r.post.votes_count>0})},[(0,o._)("span",{class:"dropdown-toggle","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",onMouseover:e[0]||(e[0]=(...t)=>r.getUsers&&r.getUsers(...t)),role:"button"},(0,g.zw)(r.votesCountText),33),(0,o._)("div",X,[i.loading?((0,o.wg)(),(0,o.iD)("div",tt,[(0,o._)("img",{src:s(79885),alt:"loader",style:{height:"50px"}},null,8,et)])):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.users,(t=>((0,o.wg)(),(0,o.j4)(l,{key:t.id,class:"dropdown-item",to:{name:"user.profile",params:{user_id:t.id}}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,g.zw)(t.name),1)])),_:2},1032,["to"])))),128)),r.moreUsersText?((0,o.wg)(),(0,o.iD)("p",st,(0,g.zw)(r.moreUsersText),1)):(0,o.kq)("",!0)])],2)])):(0,o.kq)("",!0)}var nt=s(12174),at={name:"TotalVotes",inject:["post"],data(){return{users:[],totalUsers:0,loading:!1}},computed:{moreUsersText(){const t=this.totalUsers-this.users.length,e=1===t?"آخر":"آخرين";return t>0?`و +${t} ${e}`:""},votesCountText(){return 0==this.post.votes_count?"لا يوجد تصويتات":this.post.votes_count+" "+(this.post.votes_count<=10&&this.post.votes_count>2?"تصويتات":"تصويت")}},methods:{async getUsers(){if(!(this.post.votes_count<=0||this.loading)){this.loading=!0;try{var t;const e=await nt.Z.getPostVotesUsers(this.post.id,null!==(t=this.$route.params.user_id)&&void 0!==t?t:"");this.users=e.data.users,this.totalUsers=e.data.count}catch(e){x.Z.toggleToast("حدث خطأ ما, حاول مرة أخرى","error")}finally{this.loading=!1}}}}};const it=(0,T.Z)(at,[["render",ot]]);var rt=it,lt={name:"PostFooter",components:{TotalComments:P,TotalLikes:B,ActionButtons:G,TotalVotes:rt}};const dt=(0,T.Z)(lt,[["render",h]]);var mt=dt,ct=s(11035);const pt={key:0,class:"support-checkbox mt-3"},ut={class:"d-flex justify-content-start align-items-center"},ht=(0,o._)("label",{for:"support-checkbox",class:"form-check-label text-primary"},[(0,o._)("span",{class:"ms-1"}," أتعهد بأنني قرأت المنشور كاملاً ")],-1);function gt(t,e,s,n,a,i){return"support"===i.post.type.toLowerCase()?((0,o.wg)(),(0,o.iD)("div",pt,[(0,o._)("div",ut,[(0,o.wy)((0,o._)("input",{type:"checkbox",id:"support-checkbox",class:"form-check-input","onUpdate:modelValue":e[0]||(e[0]=t=>a.supported=t),onChange:e[1]||(e[1]=(...t)=>i.pledgeReadingPost&&i.pledgeReadingPost(...t)),style:{width:"18px",height:"18px",margin:"0"}},null,544),[[f.e8,a.supported]]),ht])])):(0,o.kq)("",!0)}s(48324);var ft={name:"SupportSection",inject:{post:{required:!0}},data(){return{supported:!1}},created(){const t=JSON.parse(localStorage.getItem("pledges"));this.supported=!!t&&t[this.post.id]===this.$store.getters.getUser.id},methods:{pledgeReadingPost(t){const e=this.$store.getters.getUser.id;let s=localStorage.getItem("pledges");t.target.checked?s?(s=JSON.parse(s),s[this.post.id]&&s[this.post.id]===e||(s[this.post.id]=e,localStorage.setItem("pledges",JSON.stringify(s)))):localStorage.setItem("pledges",JSON.stringify({[this.post.id]:e})):s&&(s=JSON.parse(s),s[this.post.id]&&s[this.post.id]===e&&(delete s[this.post.id],localStorage.setItem("pledges",JSON.stringify(s))))}}};const wt=(0,T.Z)(ft,[["render",gt]]);var Ct=wt;const yt=(0,o._)("h4",null,"التعليقات",-1),_t={href:"javascript:void(0);",class:"lh-1","data-bs-dismiss":"modal",ref:"commentModalCloseBtn"},vt=(0,o._)("span",{class:"material-symbols-outlined"},"close",-1),bt=[vt],kt={class:"row"};function xt(t,e,s,n,a,i){const r=(0,o.up)("model-header"),l=(0,o.up)("LazyLoadedComments"),d=(0,o.up)("model-body"),m=(0,o.up)("CreateComment"),c=(0,o.up)("model-footer"),p=(0,o.up)("modal");return(0,o.wg)(),(0,o.j4)(p,{ref:"commentModalRef",id:`commentModal-${i.post.id}`,tabindex:"-1","aria-labelledby":`commentModalLabel-${i.post.id}`,"aria-hidden":!0,dialogClass:"modal-lg modal-dialog-centered modal-dialog-scrollable",style:{height:"95%","padding-top":"9%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(r,null,{default:(0,o.w5)((()=>[yt,(0,o._)("a",_t,bt,512)])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o._)("div",kt,[(0,o.Wm)(l,{post:i.post,ref:"lazyLoadedCommentsRef"},null,8,["post"])])])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[i.post.allow_comments?((0,o.wg)(),(0,o.j4)(m,{key:0,type:"comment",class:"flex-grow-1",post_id:i.post.id,onAddComment:i.addComment},null,8,["post_id","onAddComment"])):(0,o.kq)("",!0)])),_:1})])),_:1},8,["id","aria-labelledby"])}var Mt=s(79909),Tt=s(19250),Ut=s(21295),Pt={name:"CommentsModal",components:{CreateComment:Tt.Z,LazyLoadedComments:Ut.Z},inject:["post"],data(){return{commentModal:null}},watch:{$route(t,e){this.commentModal.hide()}},mounted(){this.commentModal=new Mt.u_(this.$refs.commentModalRef.$el)},methods:{showCommentModel(){this.$refs.lazyLoadedCommentsRef.resetData(),this.commentModal.show()},addComment(t,e){this.$refs.lazyLoadedCommentsRef.addComment(t,e),e||this.$nextTick((()=>{const t=this.$refs.commentModalRef.$el,e=t.querySelector(".modal-body");e.scrollTop=e.scrollHeight}))}}};const Zt=(0,T.Z)(Pt,[["render",xt]]);var Dt=Zt,qt={name:"Post",components:{PostHeader:l.Z,PostBody:d.Z,CommentsModal:Dt,PostMedia:ct.Z,PostFooter:mt,SupportSection:Ct},provide(){return{post:this.post,showCommentModel:this.showCommentModel}},inject:{focusComment:{default:()=>{}}},props:{post:{type:Object,required:!0},showPin:{type:Boolean,default:!1}},methods:{resolve_img_url:function(t){let e=s(20398);return e("./"+t)},showCommentModel(){if("support"===this.post.type.toLowerCase()){const t=JSON.parse(localStorage.getItem("pledges")),e=!!t&&t[this.post.id]===this.$store.getters.getUser.id;if(!e)return void x.Z.toggleToast("يجب أن تتعهد بأنك قرأت المنشور كاملاً","warning")}this.focusComment?this.focusComment():this.$refs.commentModal.showCommentModel()}}};const $t=(0,T.Z)(qt,[["render",r]]);var Rt=$t}}]);
//# sourceMappingURL=867.d0b982e2.js.map