"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[714],{90031:function(e,t,n){var r=n(50124),a=n(48534),s=n(13087),i=n(62833),o=(n(34338),n(66252)),u=n(24150),c=function(){function e(){(0,s.Z)(this,e),this.prefix="general-conversations"}return(0,i.Z)(e,[{key:"addQuestion",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,s;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=new FormData,n.append("question",t.question),t.media&&t.media.length>0)for(a=0;a<t.media.length;a++)n.append("media[]",t.media[a]);return e.prev=3,e.next=6,u.hi.post("".concat(this.prefix,"/questions"),n,{headers:{"Content-type":"multipart/form-data"}});case 6:return s=e.sent,e.abrupt("return",s.data);case 10:e.prev=10,e.t0=e["catch"](3),(0,o.S3)(e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addAnswer",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new FormData,n.append("answer",t.answer),n.append("question_id",t.question_id),t.image&&n.append("image",t.image),e.prev=4,e.next=7,u.hi.post("".concat(this.prefix,"/answers"),n,{headers:{"Content-type":"multipart/form-data"}});case 7:return a=e.sent,e.abrupt("return",a.data);case 11:e.prev=11,e.t0=e["catch"](4),(0,o.S3)(e.t0);case 14:case"end":return e.stop()}}),e,this,[[4,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getQuestions",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.get("".concat(this.prefix,"/questions?page=").concat(t));case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getQuestionById",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.get("".concat(this.prefix,"/questions/").concat(t));case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getMyQuestions",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.get("".concat(this.prefix,"/questions/my-questions?page=").concat(t));case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getAssignedToMeQuestions",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.get("".concat(this.prefix,"/questions/assigned-to-me?page=").concat(t));case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"solveQuestion",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.put("".concat(this.prefix,"/questions/").concat(t,"/solve"));case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"closeQuestion",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.put("".concat(this.prefix,"/questions/").concat(t,"/close"));case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"assignToParent",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.put("".concat(this.prefix,"/questions/").concat(t,"/assign-to-parent"));case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getStatistics",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.get("".concat(this.prefix,"/questions/statistics"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"closeOverdueQuestions",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.put("".concat(this.prefix,"/questions/close-overdue"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"addWorkingHours",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.post("".concat(this.prefix,"/working-hours"),{date:t,minutes:n});case 3:return a=e.sent,e.abrupt("return",a.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getWorkingHours",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.get("".concat(this.prefix,"/working-hours"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getWorkingHoursStatistics",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a=arguments;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",e.prev=1,e.next=4,u.hi.get("".concat(this.prefix,"/working-hours/statistics?date=").concat(t));case 4:return n=e.sent,e.abrupt("return",n.data);case 8:e.prev=8,e.t0=e["catch"](1),(0,o.S3)(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"addFollowup",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.post("".concat(this.prefix,"/followup"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFollowupStatistics",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.hi.get("".concat(this.prefix,"/followup/statistics"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,o.S3)(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()}]),e}();t.Z=new c},53186:function(e,t,n){n.d(t,{Z:function(){return v}});n(76801),n(43843);var r=n(66252),a={class:"preview-images"},s=["onClick"],i=(0,r._)("span",null," x ",-1),o=[i],u=["src"],c=["src"];function l(e,t,n,i,l,d){return(0,r.wg)(),(0,r.iD)("div",a,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(l.previewUrls,(function(e,t){return(0,r.wg)(),(0,r.iD)("div",{class:"image-container",key:e.url},[(0,r._)("div",{class:"delete-image",onClick:function(e){return d.removeMedia(t)}},o,8,s),e.type.includes("image")?((0,r.wg)(),(0,r.iD)("img",{key:0,src:e.url},null,8,u)):((0,r.wg)(),(0,r.iD)("video",{key:1,src:e.url,autoplay:""},null,8,c))])})),128))])}var d=n(89584),p=(n(60228),n(47522),n(70560),n(62506),{name:"ImagePreviewer",props:{media:{type:[Array,FileList],default:function(){return[]}}},emits:["remove-media"],data:function(){return{previewUrls:[]}},methods:{previewMedia:function(){var e=this;this.previewUrls=[];var t=(0,d.Z)(this.media);t.forEach((function(t){var n=new FileReader;n.onload=function(){e.previewUrls.push({url:n.result,type:t.type})},n.readAsDataURL(t)}))},removeMedia:function(e){this.previewUrls.splice(e,1),this.$emit("remove-media",e)},clearMedia:function(){this.previewUrls=[]}},mounted:function(){this.previewMedia()},watch:{media:function(){this.previewMedia()}}}),f=n(83744);const h=(0,f.Z)(p,[["render",l]]);var v=h},50714:function(e,t,n){n.r(t),n.d(t,{default:function(){return Xe}});var r=n(66252),a=n(3577),s=function(e){return(0,r.dD)("data-v-4643f242"),e=e(),(0,r.Cn)(),e},i={key:0,class:"col-sm-12 text-center"},o=["src"],u={key:1,class:"row"},c=s((function(){return(0,r._)("div",{class:"col-sm-12"},[(0,r._)("div",{class:"card position-relative inner-page-bg bg-primary mb-2",style:{height:"80px"}},[(0,r._)("div",{class:"inner-page-title"},[(0,r._)("h2",{class:"text-white"},"التحويل العام")])])],-1)})),l={key:1,class:"col-12 my-2"},d={key:0,class:"col-sm-12 text-center"},p=["src"],f={key:1},h={class:"col-12"},v={class:"card card-block card-stretch card-height blog"},g={key:0,class:"card-header"},w={class:"card-body"},m={class:"blog-description"},y={class:"col-lg-12 mb-3"},b={key:0,class:"d-flex align-items-center justify-content-start"},k={class:"me-2"},x={key:2,class:"col-sm-12 text-center"},Z=["src"],_={key:3,class:"col-12"},q={class:"card card-block card-stretch card-height blog"},D=["disabled"];function Q(e,t,s,Q,A,C){var F=(0,r.up)("AddQuestion"),$=(0,r.up)("FilterQuestion"),S=(0,r.up)("font-awesome-icon"),T=(0,r.up)("Questions");return A.loadingClose?((0,r.wg)(),(0,r.iD)("div",i,[(0,r._)("img",{src:n(79885),alt:"loader",style:{height:"100px"}},null,8,o)])):((0,r.wg)(),(0,r.iD)("div",u,[c,A.questionId?(0,r.kq)("",!0):((0,r.wg)(),(0,r.j4)(F,{key:0,onAddQuestion:C.addNewQuestion},null,8,["onAddQuestion"])),!A.questionId&&A.showFollowupButton?((0,r.wg)(),(0,r.iD)("div",l,[(0,r._)("button",{class:"btn btn-info",onClick:t[0]||(t[0]=function(){return C.addFollowupAction&&C.addFollowupAction.apply(C,arguments)})},[A.loadingFollowupAddition?((0,r.wg)(),(0,r.iD)("div",d,[(0,r._)("img",{src:n(79885),alt:"loader",style:{height:"30px"}},null,8,p)])):((0,r.wg)(),(0,r.iD)("span",f,(0,a.zw)(C.counterText),1))])])):(0,r.kq)("",!0),(0,r._)("div",h,[(0,r._)("div",v,[A.questionId?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",g,[(0,r._)("h2",null,(0,a.zw)(C.title),1)])),(0,r._)("div",w,[(0,r._)("div",m,[(0,r._)("div",y,[A.questionId?((0,r.wg)(),(0,r.iD)("button",{key:1,class:"bg-primary rounded badge text-white border-0 ms-1 me-1",onClick:t[1]||(t[1]=function(){return C.backToQuestions&&C.backToQuestions.apply(C,arguments)})}," الكل ")):((0,r.wg)(),(0,r.j4)($,{key:0,filterQuestions:C.filterQuestions},null,8,["filterQuestions"]))]),A.emptyMessage?((0,r.wg)(),(0,r.iD)("div",b,[(0,r._)("div",k,[(0,r.Wm)(S,{icon:["fas","circle-exclamation"],size:"xl"})]),(0,r._)("div",null,(0,a.zw)(A.emptyMessage),1)])):((0,r.wg)(),(0,r.j4)(T,{key:1,questions:A.questions,onUpdateKey:C.updateKey},null,8,["questions","onUpdateKey"])),A.loading?((0,r.wg)(),(0,r.iD)("div",x,[(0,r._)("img",{src:n(79885),alt:"loader",style:{height:"100px"}},null,8,Z)])):(0,r.kq)("",!0),A.hasMore&&A.questions.length>0?((0,r.wg)(),(0,r.iD)("div",_,[(0,r._)("div",q,[(0,r._)("button",{type:"button",class:"btn btn-primary d-block w-100",onClick:t[2]||(t[2]=function(){return C.loadMore&&C.loadMore.apply(C,arguments)}),disabled:A.loading}," تحميل المزيد من الأسئلة ",8,D)])])):(0,r.kq)("",!0)])])])])]))}var A=n(89584),C=n(95082),F=n(50124),$=n(48534),S=(n(70560),n(91719),n(25728),n(60228),n(34338),n(64043),n(57267),n(49579)),T=n(49963),M=(0,r._)("h4",{class:"card-title"},"طرح سؤال",-1),I={class:"d-flex align-items-center"},B={class:"post-text ml-3 w-100"},U=(0,r._)("hr",null,null,-1),R={key:1,class:"col-sm-12 text-center"},z=["src"],W=["disabled"];function E(e,t,a,s,i,o){var u=(0,r.up)("BaseAvatar"),c=(0,r.up)("ImagePreviewer"),l=(0,r.up)("iq-card");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(l,{id:"question-modal-data","body-class":"iq-card iq-card-block iq-card-stretch iq-card-height"},{headerTitle:(0,r.w5)((function(){return[M]})),body:(0,r.w5)((function(){var e,a,s,l;return[(0,r._)("div",I,[(0,r.Wm)(u,{profileImg:null===(e=o.auth)||void 0===e||null===(e=e.user_profile)||void 0===e?void 0:e.profile_picture,profile_id:null===(a=o.auth)||void 0===a||null===(a=a.user_profile)||void 0===a?void 0:a.id,title:null===(s=o.auth)||void 0===s?void 0:s.name,gender:null===(l=o.auth)||void 0===l?void 0:l.gender,avatarClass:"avatar-60 rounded-circle"},null,8,["profileImg","profile_id","title","gender"]),(0,r._)("form",B,[(0,r.wy)((0,r._)("textarea",{id:"question-editor",placeholder:"اطرح سؤالك هنا...",class:"rounded form-control",style:{border:"none","max-height":"50vh"},"onUpdate:modelValue":t[0]||(t[0]=function(e){return i.question.question=e}),ref:"questionRef"},"\n            ",512),[[T.nr,i.question.question,void 0,{trim:!0}]]),(0,r._)("input",{type:"file",onChange:t[1]||(t[1]=function(e){return o.previewMedia(e)}),multiple:"",accept:"image/*",class:"d-none",ref:"fileRef"},null,544)])]),i.question.media.length>0?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[U,(0,r.Wm)(c,{media:i.question.media,onRemoveMedia:o.removeMedia},null,8,["media","onRemoveMedia"])],64)):(0,r.kq)("",!0),i.loader?((0,r.wg)(),(0,r.iD)("div",R,[(0,r._)("img",{src:n(79885),alt:"loader",style:{height:"100px"}},null,8,z)])):((0,r.wg)(),(0,r.iD)("button",{key:2,class:"btn btn-primary btn-block my-3 w-100 flex-grow-1",onClick:t[2]||(t[2]=function(e){return o.addNewQuestion()}),disabled:!o.allowPosting}," نشـــر ",8,W))]})),_:1})])}n(62506);var P=n(53186),K=n(31025),j=n(90031),H={name:"AddQuestion",components:{ImagePreviewer:P.Z},emits:["add-question"],data:function(){return{question:{question:"",media:[]},loader:!1}},computed:{auth:function(){return this.$store.getters.getUser},allowPosting:function(){return""!==this.question.question},questionBody:function(){return this.question.question}},watch:{questionBody:function(){var e=this;this.$refs.questionRef.style.height="auto",this.$nextTick((function(){e.$refs.questionRef.style.height=e.$refs.questionRef.scrollHeight+"px"}))}},methods:{openFilePicker:function(){this.$refs.fileRef.click()},previewMedia:function(e){var t=(0,A.Z)(e.target.files);this.question.media=t},removeMedia:function(e){var t=(0,A.Z)(this.question.media);t.splice(e,1),this.question.media=t,0===this.question.media.length&&(this.$refs.fileRef.value=null)},addNewQuestion:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){var n;return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loader=!0,t.prev=1,t.next=4,j.Z.addQuestion(e.question);case 4:n=t.sent,e.$emit("add-question",n.data),e.question={question:"",media:[]},t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),K.Z.toggleErrorToast();case 12:return t.prev=12,e.loader=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,9,12,15]])})))()}}},N=n(83744);const O=(0,N.Z)(H,[["render",E]]);var Y=O,L={class:"accordion",id:"questions-accordion"},V={class:"card card-block card-stretch card-height blog"},G={class:"card-body"},J={class:"accordion-item mb-3"},X={class:"mt-3 d-flex align-items-center justify-content-start w-100"},ee={class:"ms-3"},te={class:"accordion-header",id:"heading1"},ne=["data-bs-target","aria-controls"],re=["id"],ae={class:"accordion-body"},se={key:0},ie={key:1},oe={class:"d-flex align-items-center justify-content-start w-100 mb-2"},ue={class:"ms-3"},ce={class:""},le={class:"d-flex flex-wrap align-items-center comment-activity"},de={key:0},pe={class:"my-2"},fe={key:2,class:"mt-3 d-flex align-content-start flex-wrap"},he=["onClick","disabled"],ve=["src"],ge={key:1},we=["onClick","disabled"],me=["src"],ye={key:1},be=["onClick"],ke=["src"],xe={key:1};function Ze(e,t,s,i,o,u){var c=(0,r.up)("BaseAvatar"),l=(0,r.up)("tooltip"),d=(0,r.up)("AddAnswer"),p=(0,r.up)("QuestionStat");return(0,r.wg)(),(0,r.iD)("div",L,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.questions,(function(t){return(0,r.wg)(),(0,r.iD)("div",{class:"cols",key:t.id},[(0,r._)("div",V,[(0,r._)("div",G,[(0,r._)("div",J,[(0,r._)("div",X,[(0,r.Wm)(c,{profileImg:t.user.profile.profile_picture,profile_id:t.user.profile.id,title:t.user.name,gender:t.user.gender,avatarClass:"rounded-circle avatar-40"},null,8,["profileImg","profile_id","title","gender"]),(0,r._)("div",ee,[(0,r._)("h6",null,(0,a.zw)(t.user.name),1)])]),(0,r._)("h2",te,[(0,r._)("button",{class:"rtl accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+t.id,"aria-expanded":"true","aria-controls":"collapse"+t.id},(0,a.zw)(t.question),9,ne)]),(0,r._)("div",{id:"collapse"+t.id,class:"accordion-collapse collapse","aria-labelledby":"heading1","data-bs-parent":"#questions-accordion"},[(0,r._)("div",ae,[0===t.answers.length?((0,r.wg)(),(0,r.iD)("p",se,"لا يوجد إجابات")):((0,r.wg)(),(0,r.iD)("h3",ie,"الإجابات")),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.answers,(function(n){var s,i,o,u;return(0,r.wg)(),(0,r.iD)("div",{class:"mt-3 w-100",key:n.id},[(0,r._)("div",oe,[(0,r.Wm)(c,{profileImg:null===(s=n.user)||void 0===s?void 0:s.profile.profile_picture,profile_id:null===(i=n.user)||void 0===i?void 0:i.profile.id,title:null===(o=n.user)||void 0===o?void 0:o.name,gender:null===(u=n.user)||void 0===u?void 0:u.gender,avatarClass:"rounded-circle avatar-40"},null,8,["profileImg","profile_id","title","gender"]),(0,r._)("div",ue,[(0,r._)("h6",null,(0,a.zw)(n.user.name),1)])]),(0,r._)("div",null,[(0,r._)("p",ce,(0,a.zw)(n.answer),1),(0,r._)("div",le,[(0,r.Wm)(l,{tag:"span",class:"text-muted small",tooltipPlacement:"bottom","data-bs-toggle":"tooltip",title:e.formatFullDate(n.created_at)},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(e.formatDateToWritten(n.created_at)),1)]})),_:2},1032,["title"])])]),n.id!==t.answers[t.answers.length-1].id?((0,r.wg)(),(0,r.iD)("hr",de)):(0,r.kq)("",!0)])})),128)),(0,r._)("div",pe,["open"===t.status?((0,r.wg)(),(0,r.j4)(d,{key:0,question_id:t.id},null,8,["question_id"])):(0,r.kq)("",!0)]),(0,r.Wm)(p,{question:t},null,8,["question"]),"open"===t.status?((0,r.wg)(),(0,r.iD)("div",fe,[u.canEdit(t)?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[(0,r._)("button",{class:"bg-primary rounded badge text-white border-0 ms-1 me-1",onClick:function(e){return u.solveQuestion(t)},disabled:o.loadingSolve},[o.loadingSolve?((0,r.wg)(),(0,r.iD)("img",{key:0,src:n(79885),alt:"loader",style:{height:"20px"}},null,8,ve)):((0,r.wg)(),(0,r.iD)("span",ge," تم الحل "))],8,he),(0,r._)("button",{class:"bg-danger rounded badge text-white border-0 ms-1 me-1",onClick:function(e){return u.closeQuestion(t)},disabled:o.loadingClose},[o.loadingClose?((0,r.wg)(),(0,r.iD)("img",{key:0,src:n(79885),alt:"loader",style:{height:"20px"}},null,8,me)):((0,r.wg)(),(0,r.iD)("span",ye," إغلاق "))],8,we)],64)):(0,r.kq)("",!0),t.assignee.id!==u.auth.id||u.isAssigneeAdmin(t.assignee)?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("button",{key:1,class:"bg-dark rounded badge text-white border-0 ms-1 me-1",onClick:function(e){return u.assignToParent(t)}},[o.loadingAssign?((0,r.wg)(),(0,r.iD)("img",{key:0,src:n(79885),alt:"loader",style:{height:"20px"}},null,8,ke)):((0,r.wg)(),(0,r.iD)("span",xe," تعيين إلى اسم المسؤول "))],8,be))])):(0,r.kq)("",!0)])],8,re)])])])])})),128))])}var _e={class:"d-flex flex-column"},qe={class:"comment-attagement right d-flex mb-1"},De=["disabled"];function Qe(e,t,n,s,i,o){return(0,r.wg)(),(0,r.iD)("div",_e,[(0,r._)("form",{class:"comment-text d-flex align-items-end mt-3",onSubmit:t[1]||(t[1]=(0,T.iM)((function(){return o.addAnswer&&o.addAnswer.apply(o,arguments)}),["prevent"]))},[(0,r.wy)((0,r._)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=function(e){return s.v$.answerData.answer.$model=e}),class:"form-control rounded",placeholder:"أضف إجابة",style:(0,a.j5)([{"padding-right":"3rem !important"},{direction:"rtl","max-height":"120px",resize:"none",overflow:"auto"}]),rows:1,ref:"bodyRef"},null,512),[[T.nr,s.v$.answerData.answer.$model,void 0,{trim:!0}]]),(0,r._)("div",qe,[(0,r._)("button",{type:"submit",class:(0,a.C_)(["material-symbols-outlined ms-2 border-0 bg-transparent",{"text-primary":!s.v$.answerData.$invalid,disabled:s.v$.answerData.$invalid}]),disabled:s.v$.answerData.$invalid||i.loading}," Send ",10,De)])],32)])}n(79288);var Ae=n(5705),Ce=n(10760),Fe={name:"AddAnswer",setup:function(){var e=(0,Ae.ZP)();return{v$:e}},emits:["add-answer"],inject:{addNewAnswer:{default:function(){return function(){}}}},props:{question_id:{type:Number,required:!0}},data:function(){return{loading:!1,answerData:{answer:"",image:null,question_id:this.question_id}}},computed:{answerBody:function(){return this.answerData.answer}},watch:{answerBody:function(){var e=this;this.$refs.bodyRef.style.height="auto",this.$nextTick((function(){e.$refs.bodyRef.style.height=e.$refs.bodyRef.scrollHeight+"px"}))}},methods:{addAnswer:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){var n;return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loading){t.next=2;break}return t.abrupt("return");case 2:if(e.v$.$touch(),e.v$.answerData.$invalid){t.next=24;break}return e.loading=!0,t.prev=5,t.next=8,j.Z.addAnswer(e.answerData);case 8:n=t.sent,e.addNewAnswer(n.data),e.answerData.answer="",e.answerData.image=null,e.v$.$reset(),K.Z.toggleToast("تم إضافة الجواب ","success"),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](5),K.Z.toggleErrorToast("حدث خطأ ما, حاول مرة أخرى");case 19:return t.prev=19,e.loading=!1,t.finish(19);case 22:t.next=25;break;case 24:K.Z.toggleToast("يرجى إدخال البيانات","error");case 25:case"end":return t.stop()}}),t,null,[[5,16,19,22]])})))()}},validations:function(){return{answerData:{answer:{required:Ce.C1}}}}};const $e=(0,N.Z)(Fe,[["render",Qe],["__scopeId","data-v-0c5c061b"]]);var Se=$e,Te={class:"mt-3 d-flex align-content-start flex-wrap"},Me={class:"ms-2 me-2"},Ie={class:"ms-2 me-2"},Be=(0,r._)("span",{class:"align-middle material-symbols-outlined"}," forum ",-1),Ue=(0,r._)("span",{class:"align-middle material-symbols-outlined"}," person_check ",-1),Re={style:{"font-weight":"bold"}};function ze(e,t,n,s,i,o){return(0,r.wg)(),(0,r.iD)("div",Te,[(0,r._)("small",Me,[(0,r._)("span",{class:(0,a.C_)(["align-middle material-symbols-outlined",i.isWarning?"text-warning":"text-success"])},(0,a.zw)(i.isWarning?"warning":"task_alt"),3),(0,r.Uk)(" "+(0,a.zw)(o.getStatusText()),1)]),(0,r._)("small",Ie,[Be,(0,r.Uk)(" "+(0,a.zw)(n.question.answers.length>0?"".concat(n.question.answers.length," إجابات"):"لا يوجد إجابات"),1)]),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(n.question.user_parents,(function(e){return(0,r.wg)(),(0,r.iD)("small",{class:"ms-2 me-2",key:e.role},[Ue,(0,r._)("span",Re,(0,a.zw)("".concat(e.role,":")),1),(0,r.Uk)(" "+(0,a.zw)(e.name),1)])})),128))])}var We={name:"QuestionStat",data:function(){return{isWarning:!1}},props:{question:{type:Object,required:!0}},methods:{getStatusText:function(){var e;switch(null===(e=this.question)||void 0===e?void 0:e.status){case"open":var t=K.Z.getDifferenceBetweenDates(this.question.created_at,new Date),n=t.hours;return n>=48?(this.isWarning=!0,"مفتوح لأكثر من يومين"):"لم يتم الحل";case"closed":return"مغلق";case"solved":this.isWarning=!1;var r=K.Z.getDifferenceBetweenDates(this.question.created_at,this.question.updated_at),a=r.hours;return a<=12?"تم الحل خلال 12 ساعة":"تم الحل بعد أكثر من 12 ساعة";default:return"غير معروف"}}}};const Ee=(0,N.Z)(We,[["render",ze]]);var Pe=Ee,Ke={name:"Questions",components:{QuestionStat:Pe,AddAnswer:Se},data:function(){return{loadingSolve:!1,loadingClose:!1,loadingAssign:!1}},emits:["updateKey"],props:{questions:{type:Array,required:!0}},computed:{auth:function(){return this.$store.getters.getUser}},methods:(0,C.Z)((0,C.Z)({},K.Z),{},{canEdit:function(e){return e.user.id===this.auth.id||e.assignee.id===this.auth.id||S.Z.hasRole(this.auth,"admin")},solveQuestion:function(e){var t=this;return(0,$.Z)((0,F.Z)().mark((function n(){var r;return(0,F.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.loadingSolve){n.next=2;break}return n.abrupt("return");case 2:return t.loadingSolve=!0,n.prev=3,n.next=6,j.Z.solveQuestion(e.id);case 6:r=n.sent,t.$emit("updateKey",e,"status",r.data.status),t.$emit("updateKey",e,"updated_at",r.data.updated_at),t.toggleToast("تم حل السؤال","success"),n.next=15;break;case 12:n.prev=12,n.t0=n["catch"](3),t.toggleErrorToast();case 15:return n.prev=15,t.loadingSolve=!1,n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[3,12,15,18]])})))()},closeQuestion:function(e){var t=this;return(0,$.Z)((0,F.Z)().mark((function n(){var r;return(0,F.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.loadingClose){n.next=2;break}return n.abrupt("return");case 2:return t.loadingClose=!0,n.prev=3,n.next=6,j.Z.closeQuestion(e.id);case 6:r=n.sent,t.$emit("updateKey",e,"status",r.data.status),t.$emit("updateKey",e,"updated_at",r.data.updated_at),t.toggleToast("تم إغلاق السؤال","success"),n.next=15;break;case 12:n.prev=12,n.t0=n["catch"](3),t.toggleErrorToast();case 15:return n.prev=15,t.loadingClose=!1,n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[3,12,15,18]])})))()},assignToParent:function(e){var t=this;return(0,$.Z)((0,F.Z)().mark((function n(){var r;return(0,F.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.loadingAssign){n.next=2;break}return n.abrupt("return");case 2:return t.loadingAssign=!0,n.prev=3,n.next=6,j.Z.assignToParent(e.id);case 6:r=n.sent,t.$emit("updateKey",e,"assignee",r.data.assignee),t.toggleToast("تم تعيين السؤال للمشرف","success"),n.next=14;break;case 11:n.prev=11,n.t0=n["catch"](3),t.toggleErrorToast();case 14:return n.prev=14,t.loadingAssign=!1,n.finish(14);case 17:case"end":return n.stop()}}),n,null,[[3,11,14,17]])})))()},isAssigneeAdmin:function(e){return S.Z.hasRole(e.assignee,"admin")}})};const je=(0,N.Z)(Ke,[["render",Ze],["__scopeId","data-v-c96ceb2e"]]);var He=je,Ne={class:"my-2 d-flex align-content-start flex-wrap"};function Oe(e,t,n,a,s,i){return(0,r.wg)(),(0,r.iD)("div",Ne,[(0,r._)("button",{class:"bg-primary rounded badge text-white border-0 ms-1 me-1",onClick:t[0]||(t[0]=function(e){return n.filterQuestions("all")})}," الكل "),(0,r._)("button",{class:"bg-dark rounded badge text-white border-0 ms-1 me-1",onClick:t[1]||(t[1]=function(e){return n.filterQuestions("my-questions")})}," أسئلتي "),(0,r._)("button",{class:"bg-danger rounded badge text-white border-0 ms-1 me-1",onClick:t[2]||(t[2]=function(e){return n.filterQuestions("assigned-to-me")})}," معينة لي ")])}var Ye={name:"FilterQuestion",props:{filterQuestions:{type:Function,required:!0}}};const Le=(0,N.Z)(Ye,[["render",Oe]]);var Ve=Le,Ge={name:"GeneralConversation",components:{AddQuestion:Y,Questions:He,FilterQuestion:Ve},provide:function(){return{addNewAnswer:this.addNewAnswer}},created:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkUserPermission();case 2:return t.next=4,e.getQuestions();case 4:e.followupCounter=e.userFollowup?e.userFollowup.counter:0;case 5:case"end":return t.stop()}}),t)})))()},data:function(){return{questions:[],loading:!1,emptyMessage:"",keyword:"all",loadingClose:!1,hasMore:!1,page:1,questionId:this.$route.params.questionId||null,userFollowup:null,showFollowupButton:!1,followupCounter:null,loadingFollowupAddition:!1}},computed:{auth:function(){return this.$store.getters.getUser},title:function(){return"my-questions"===this.keyword?"أسئلتي":"assigned-to-me"===this.keyword?"الأسئلة المعينة لي":"كل الأسئلة"},counterText:function(){return 0===this.followupCounter?"التفقد الأول":"التفقد الثاني"}},watch:{keyword:function(e){this.emptyMessage="",this.page=1,this.hasMore=!1,this.questions=[],this.getQuestions()},userFollowup:function(e){if((null===e||void 0===e?void 0:e.counter)>=2)this.showFollowupButton=!1;else if(e){var t=new Date,n=new Date(null===e||void 0===e?void 0:e.updated_at),r=Math.abs(t-n),a=Math.ceil(r/36e5);this.showFollowupButton=!(a<6)}else this.showFollowupButton=!0}},methods:(0,C.Z)((0,C.Z)({},K.Z),{},{checkUserPermission:function(){S.Z.hasRoles(this.auth,["admin","consultant","advisor","supervisor","leader"])||this.$router.push({name:"NotFound"})},addNewQuestion:function(e){this.questions.unshift(e)},addNewAnswer:function(e){var t=this.questions.find((function(t){return t.id===e.question_id}));t&&t.answers.push(e)},getQuestions:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){var n;return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loading){t.next=2;break}return t.abrupt("return");case 2:if(e.loading=!0,t.prev=3,!e.questionId){t.next=16;break}return t.next=7,j.Z.getQuestionById(e.questionId);case 7:if(n=t.sent,n.data){t.next=11;break}return e.emptyMessage=n.message,t.abrupt("return");case 11:return e.questions=[n.data],e.hasMore=!1,t.abrupt("return");case 16:if("all"!==e.keyword&&""!==e.keyword){t.next=22;break}return t.next=19,j.Z.getQuestions(e.page);case 19:n=t.sent,t.next=32;break;case 22:if("my-questions"!==e.keyword){t.next=28;break}return t.next=25,j.Z.getMyQuestions(e.page);case 25:n=t.sent,t.next=32;break;case 28:if("assigned-to-me"!==e.keyword){t.next=32;break}return t.next=31,j.Z.getAssignedToMeQuestions(e.page);case 31:n=t.sent;case 32:if(0!==n.data.questions.length){t.next=36;break}return e.emptyMessage=n.message,e.userFollowup=n.data.user_followup,t.abrupt("return");case 36:e.questions=[].concat((0,A.Z)(e.questions),(0,A.Z)(n.data.questions)),e.hasMore=n.data.has_more_pages,e.userFollowup=n.data.user_followup;case 39:t.next=44;break;case 41:t.prev=41,t.t0=t["catch"](3),e.toggleErrorToast();case 44:return t.prev=44,e.loading=!1,t.finish(44);case 47:case"end":return t.stop()}}),t,null,[[3,41,44,47]])})))()},filterQuestions:function(e){var t=this;return(0,$.Z)((0,F.Z)().mark((function n(){return(0,F.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.keyword=e;case 1:case"end":return n.stop()}}),n)})))()},loadMore:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.page++,t.next=3,e.getQuestions();case 3:case"end":return t.stop()}}),t)})))()},updateKey:function(e,t,n){e[t]=n},closeOverdueQuestions:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loadingClose){t.next=2;break}return t.abrupt("return");case 2:return e.loadingClose=!0,t.prev=3,t.next=6,j.Z.closeOverdueQuestions();case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](3),e.toggleErrorToast();case 11:return t.prev=11,e.loadingClose=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[3,8,11,14]])})))()},backToQuestions:function(){this.$router.replace({name:"general-conversation.index"}),this.questionId=null,this.questions=[],this.getQuestions()},checkFollowup:function(){if(this.userFollowup){var e=new Date,t=new Date(this.userFollowup.updated_at),n=Math.abs(e-t)/36e5;console.log(this.userFollowup),n<6&&(this.showFollowupButton=!1)}},addFollowupAction:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){var n;return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loadingFollowupAddition){t.next=2;break}return t.abrupt("return");case 2:if(!(e.followupCounter>=2)){t.next=6;break}return t.abrupt("return");case 6:if(1!==e.followupCounter){t.next=12;break}return t.next=9,e.addFollowup();case 9:return t.abrupt("return");case 12:n=e.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg"},buttonsStyling:!1}),n.fire({title:"تنويه",text:"لا يمكنك إدخال التفقد الثاني إلا بعد مرور 6 ساعات على إدخال التفقد الأول",showCancelButton:!1,confirmButtonText:"حسنًا",icon:"warning",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then(function(){var t=(0,$.Z)((0,F.Z)().mark((function t(n){return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.isConfirmed){t.next=3;break}return t.next=3,e.addFollowup();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 14:case"end":return t.stop()}}),t)})))()},addFollowup:function(){var e=this;return(0,$.Z)((0,F.Z)().mark((function t(){var n;return(0,F.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingFollowupAddition=!0,t.prev=1,t.next=4,j.Z.addFollowup();case 4:n=t.sent,setTimeout((function(){e.$swal.fire({title:"تم إضافة التفقد بنجاح",icon:"success",showCancelButton:!1,confirmButtonText:"حسنًا",customClass:{confirmButton:"btn btn-primary btn-lg"},buttonsStyling:!1}),e.userFollowup=n.data}),1e3),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.toggleErrorToast();case 11:return t.prev=11,e.loadingFollowupAddition=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()}})};const Je=(0,N.Z)(Ge,[["render",Q],["__scopeId","data-v-4643f242"]]);var Xe=Je},27413:function(e,t,n){var r=n(44201),a=r("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[a]=!1,"/./"[e](t)}catch(r){}}return!1}},98494:function(e,t,n){var r=n(23691),a=TypeError;e.exports=function(e,t){if(!delete e[t])throw new a("Cannot delete property "+r(t)+" of "+r(e))}},42124:function(e,t,n){var r=n(91245),a=TypeError;e.exports=function(e){if(r(e))throw new a("The method doesn't accept regular expressions");return e}},76801:function(e,t,n){var r=n(79989),a=n(84328).includes,s=n(3689),i=n(87370),o=s((function(){return!Array(1).includes()}));r({target:"Array",proto:!0,forced:o},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},62506:function(e,t,n){var r=n(79989),a=n(90690),s=n(27578),i=n(68700),o=n(6310),u=n(5649),c=n(55565),l=n(27120),d=n(76522),p=n(98494),f=n(29042),h=f("splice"),v=Math.max,g=Math.min;r({target:"Array",proto:!0,forced:!h},{splice:function(e,t){var n,r,f,h,w,m,y=a(this),b=o(y),k=s(e,b),x=arguments.length;for(0===x?n=r=0:1===x?(n=0,r=b-k):(n=x-2,r=g(v(i(t),0),b-k)),c(b+n-r),f=l(y,r),h=0;h<r;h++)w=k+h,w in y&&d(f,h,y[w]);if(f.length=r,n<r){for(h=k;h<b-r;h++)w=h+r,m=h+n,w in y?y[m]=y[w]:p(y,m);for(h=b;h>b-r+n;h--)p(y,h-1)}else if(n>r)for(h=b-r;h>k;h--)w=h+r-1,m=h+n-1,w in y?y[m]=y[w]:p(y,m);for(h=0;h<n;h++)y[h+k]=arguments[h+2];return u(y,b-r+n),f}})},91719:function(e,t,n){var r=n(79989),a=n(90690),s=n(6310),i=n(5649),o=n(98494),u=n(55565),c=1!==[].unshift(0),l=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},d=c||!l();r({target:"Array",proto:!0,arity:1,forced:d},{unshift:function(e){var t=a(this),n=s(t),r=arguments.length;if(r){u(n+r);var c=n;while(c--){var l=c+r;c in t?t[l]=t[c]:o(t,l)}for(var d=0;d<r;d++)t[d]=arguments[d]}return i(t,n+r)}})},43843:function(e,t,n){var r=n(79989),a=n(68844),s=n(42124),i=n(74684),o=n(34327),u=n(27413),c=a("".indexOf);r({target:"String",proto:!0,forced:!u("includes")},{includes:function(e){return!!~c(o(i(this)),o(s(e)),arguments.length>1?arguments[1]:void 0)}})},89584:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(49227);function a(e){if(Array.isArray(e))return(0,r.Z)(e)}n(59749),n(86544),n(60228),n(84254),n(21694),n(76265),n(77049);function s(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var i=n(12780);n(21057);function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e){return a(e)||s(e)||(0,i.Z)(e)||o()}}}]);
//# sourceMappingURL=714-legacy.9dbc4265.js.map