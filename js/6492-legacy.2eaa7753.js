"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[6492],{19057:function(e,t,s){var r=s(50124),i=s(48534),n=s(13087),o=s(62833),a=(s(34338),s(66252)),h=s(24150),l=function(){function e(){(0,n.Z)(this,e)}return(0,o.Z)(e,[{key:"getUserBooks",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var s;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.hi.get("user-books/show/".concat(t));case 3:return s=e.sent,e.abrupt("return",s.data.data);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getAllFree",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,s){var i;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.hi.get("user-books/free-books/".concat(s,"/").concat(t));case 3:return i=e.sent,e.abrupt("return",i.data.data);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(t,s){return e.apply(this,arguments)}return t}()},{key:"eligibleToWriteThesis",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var s;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.hi.get("user-books/eligible-to-write-thesis/".concat(t));case 3:return s=e.sent,e.abrupt("return",s.data.data);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"laterBooks",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var s;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.hi.get("user-books/later-books/".concat(t));case 3:return s=e.sent,e.abrupt("return",s.data.data);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteForLeater",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var s;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.hi.get("user-books/delete-for-later-book/".concat(t));case 3:return s=e.sent,e.abrupt("return",s.data.data);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"saveBookForLater",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var s;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.hi.patch("/user-books/".concat(t,"/save-for-later"));case 3:return s=e.sent,e.abrupt("return",s.data);case 7:e.prev=7,e.t0=e["catch"](0),(0,a.S3)(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()}]),e}();t.Z=new l},41251:function(e,t,s){s.d(t,{Z:function(){return be}});var r=s(66252),i=s(49963),n=s(3577),o=function(e){return(0,r.dD)("data-v-60e63b48"),e=e(),(0,r.Cn)(),e},a={class:"d-flex align-items-center w-100 row"},h={class:"row"},l=o((function(){return(0,r._)("div",{class:"form-group"},[(0,r._)("h5",{class:"form-label"},"نوع الأطروحة")],-1)})),c={class:"form-group"},u=o((function(){return(0,r._)("option",{value:""},"اختر نوع الأطروحة",-1)})),d=o((function(){return(0,r._)("option",{value:"read"},"قراءة",-1)})),p=o((function(){return(0,r._)("option",{value:"readAndWrite"},"كتابة أطروحة",-1)})),m=["disabled"],f={key:0},g=o((function(){return(0,r._)("small",null," (مغلق اليوم) ",-1)})),v=["disabled"],k={key:0},b=o((function(){return(0,r._)("small",null," (مغلق اليوم) ",-1)})),y={key:0,class:"row mt-2"},w={class:"form-group"},_={key:1,class:"row"},T=o((function(){return(0,r._)("span",{class:"material-symbols-outlined md-18"}," refresh ",-1)})),F={key:0,style:{color:"red"}},$={class:"form-group col-6"},x=o((function(){return(0,r._)("option",{value:""},"صفحة البداية",-1)})),D=["value"],O={key:0,class:"help-block"},Z={key:0,style:{color:"red"}},q={key:1,style:{color:"red"}},E={class:"form-group col-6"},S=o((function(){return(0,r._)("option",{value:""},"صفحة النهاية",-1)})),A=["value"],I={key:0,class:"help-block"},M={key:0,style:{color:"red"}},C={key:1,style:{color:"red"}},B={key:2,class:"form-group"},P=o((function(){return(0,r._)("label",{class:"form-label",for:"thesisBody"},"الأطروحة",-1)})),U={style:{direction:"rtl"}},H=o((function(){return(0,r._)("span",null," - ",-1)})),W={key:0,style:{color:"red"},class:"text-center"},z=o((function(){return(0,r._)("span",{class:"material-symbols-outlined font-small"},"error",-1)})),j={key:1,style:{color:"green"}},L=o((function(){return(0,r._)("span",{class:"material-symbols-outlined font-small"},"check_circle",-1)})),V={key:0,class:"help-block"},N={key:0,style:{color:"red"}},R={key:3,class:"form-group"},Y=o((function(){return(0,r._)("label",{class:"form-label",for:"customFile"}," اضافة اقتباس",-1)})),K={key:0,class:"help-block"},G={key:0,style:{color:"red"}},J={key:1,class:"help-block"},Q={style:{color:"red"}},X=o((function(){return(0,r._)("small",{class:"text-center mt-2 text-danger"}," ⚠️ إن الاقتباسات المصورة لا يتم الاحتفاظ بها على المنصة. لأجل ذلك نحثك على كتابة الأطروحة أو التلخيص لتحفظ أفكارك التي انتفعت بها من الكتاب.",-1)})),ee=o((function(){return(0,r._)("hr",null,null,-1)})),te={key:4,class:"text-danger text-center"},se={key:5,class:"text-danger text-center"},re={key:6,class:"col-sm-12 text-center"},ie=["src"],ne=["disabled"];function oe(e,t,o,oe,ae,he){var le=(0,r.up)("ImagePreviewer");return(0,r.wg)(),(0,r.iD)("form",{onSubmit:t[7]||(t[7]=(0,i.iM)((function(){return he.submit&&he.submit.apply(he,arguments)}),["prevent"]))},[(0,r._)("div",a,[(0,r._)("div",h,[l,(0,r._)("div",c,[(0,r.wy)((0,r._)("select",{class:"form-select w-100",name:"type_of_thesis",id:"type_of_thesis","onUpdate:modelValue":t[0]||(t[0]=function(e){return oe.v$.thesisForm.typeOfThesis.$model=e}),onChange:t[1]||(t[1]=function(e){return he.changeTypeOfThesis(e.target.options[e.target.options.selectedIndex].value)})},[u,d,p,(0,r._)("option",{value:"screenshots",disabled:ae.screenshotsDisabled},[(0,r.Uk)(" اقتباسات "),ae.screenshotsDisabled?((0,r.wg)(),(0,r.iD)("span",f,[(0,r.Uk)(" - "),g])):(0,r.kq)("",!0)],8,m),(0,r._)("option",{value:"screenshotsAndWrite",disabled:ae.screenshotsDisabled},[(0,r.Uk)(" كتابة واقتباسات "),ae.screenshotsDisabled?((0,r.wg)(),(0,r.iD)("span",k,[(0,r.Uk)(" - "),b])):(0,r.kq)("",!0)],8,v)],544),[[i.bM,oe.v$.thesisForm.typeOfThesis.$model]])])]),ae.showPages?((0,r.wg)(),(0,r.iD)("div",y,[(0,r._)("div",w,[(0,r._)("h5",{class:(0,n.C_)(["form-label",{"text-primary":0===he.pages.length&&!ae.startOver}])},(0,n.zw)(0!==he.pages.length||ae.startOver?"الصفحات":"لقد أنهيت الكتاب"),3)])])):(0,r.kq)("",!0),ae.showPages?((0,r.wg)(),(0,r.iD)("div",_,[0!==he.pages.length||ae.startOver?((0,r.wg)(),(0,r.iD)(r.HY,{key:1},[he.numberOfPages<3?((0,r.wg)(),(0,r.iD)("small",F,"* الحد الأدنى 3 صفحات")):(0,r.kq)("",!0),(0,r._)("div",$,[(0,r.wy)((0,r._)("select",{class:"form-select","data-trigger":"",name:"start_page",id:"start_page","onUpdate:modelValue":t[3]||(t[3]=function(e){return oe.v$.thesisForm.start_page.$model=e})},[x,((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(he.pages,(function(e){return(0,r.wg)(),(0,r.iD)("option",{value:e,key:e},(0,n.zw)(e),9,D)})),128))],512),[[i.bM,oe.v$.thesisForm.start_page.$model]]),oe.v$.thesisForm.start_page.$error?((0,r.wg)(),(0,r.iD)("div",O,[oe.v$.thesisForm.start_page.required.$invalid?((0,r.wg)(),(0,r.iD)("small",Z,"الرجاء اختيار صفحة البداية")):(0,r.kq)("",!0),!oe.v$.thesisForm.start_page.required.$invalid&&oe.v$.thesisForm.start_page.between.$invalid?((0,r.wg)(),(0,r.iD)("small",q,"البداية يجب ان تكون اقل من النهاية")):(0,r.kq)("",!0)])):(0,r.kq)("",!0)]),(0,r._)("div",E,[(0,r.wy)((0,r._)("select",{class:"form-select","data-trigger":"",name:"end_page",id:"end_page","onUpdate:modelValue":t[4]||(t[4]=function(e){return oe.v$.thesisForm.end_page.$model=e})},[S,((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(he.bookPagesEnd,(function(e){return(0,r.wg)(),(0,r.iD)("option",{value:e,key:e},(0,n.zw)(e),9,A)})),128))],512),[[i.bM,oe.v$.thesisForm.end_page.$model]]),oe.v$.thesisForm.end_page.$error?((0,r.wg)(),(0,r.iD)("div",I,[oe.v$.thesisForm.end_page.required.$invalid?((0,r.wg)(),(0,r.iD)("small",M,"الرجاء اختيار صفحة النهاية")):(0,r.kq)("",!0),!oe.v$.thesisForm.end_page.required.$invalid&&oe.v$.thesisForm.end_page.between.$invalid?((0,r.wg)(),(0,r.iD)("small",C,"النهاية يجب ان تكون اكبر من البداية")):(0,r.kq)("",!0)])):(0,r.kq)("",!0)])],64)):((0,r.wg)(),(0,r.iD)("button",{key:0,class:"btn btn-primary me-2 d-flex align-content-center justify-content-center",onClick:t[2]||(t[2]=(0,i.iM)((function(){return he.startBookOver&&he.startBookOver.apply(he,arguments)}),["prevent"]))},[T,(0,r.Uk)(" إعادة قراءة الكتاب ")]))])):(0,r.kq)("",!0),ae.thesis?((0,r.wg)(),(0,r.iD)("div",B,[P,(0,r.wy)((0,r._)("textarea",{rows:"5",placeholder:"... اكتب أطروحتك",class:"rounded form-control",id:"thesisBody",name:"thesisBody","onUpdate:modelValue":t[5]||(t[5]=function(e){return oe.v$.thesisForm.body.$model=e}),style:{direction:"rtl"}},null,512),[[i.nr,oe.v$.thesisForm.body.$model,void 0,{trim:!0}]]),(0,r._)("p",U,[(0,r._)("span",null,(0,n.zw)(oe.v$.thesisForm.body.$model.length)+"/400 حرف",1),H,oe.v$.thesisForm.body.$model.length<400?((0,r.wg)(),(0,r.iD)("span",W,[(0,r.Uk)("أطروحة غير شاملة "),z])):((0,r.wg)(),(0,r.iD)("span",j,[(0,r.Uk)("أطروحة شاملة "),L]))]),oe.v$.thesisForm.body.$error?((0,r.wg)(),(0,r.iD)("div",V,[oe.v$.thesisForm.body.requiredIf.$invalid?((0,r.wg)(),(0,r.iD)("small",N,"الرجاء ادخال الأطروحة")):(0,r.kq)("",!0)])):(0,r.kq)("",!0)])):(0,r.kq)("",!0),ae.screenshots?((0,r.wg)(),(0,r.iD)("div",R,[Y,(0,r._)("input",{class:"form-control",type:"file",id:"customFile",multiple:"",accept:"image/jpeg, image/png, image/jpg, image/gif, image/svg",ref:"screenShots",onChange:t[6]||(t[6]=function(){return he.previewImages&&he.previewImages.apply(he,arguments)})},null,544),oe.v$.thesisForm.screenShots.$error?((0,r.wg)(),(0,r.iD)("div",K,[oe.v$.thesisForm.screenShots.requiredIf.$invalid?((0,r.wg)(),(0,r.iD)("small",G,"الرجاء ادخال اقتباس واحد على الاقل")):(0,r.kq)("",!0)])):(0,r.kq)("",!0),ae.filesLimitError?((0,r.wg)(),(0,r.iD)("div",J,[(0,r._)("small",Q,(0,n.zw)(ae.filesLimitError),1)])):(0,r.kq)("",!0),ae.thesisForm.screenShots.length?((0,r.wg)(),(0,r.j4)(le,{key:2,media:ae.thesisForm.screenShots,onRemoveMedia:he.removeImage,ref:"imagePreviewer"},null,8,["media","onRemoveMedia"])):(0,r.kq)("",!0),X])):(0,r.kq)("",!0),ee,ae.errorMessage?((0,r.wg)(),(0,r.iD)("small",te,(0,n.zw)(ae.errorMessage),1)):(0,r.kq)("",!0),ae.mediaNoteText&&o.thesisToEdit?((0,r.wg)(),(0,r.iD)("small",se,(0,n.zw)(ae.mediaNoteText),1)):(0,r.kq)("",!0),ae.loader?((0,r.wg)(),(0,r.iD)("div",re,[(0,r._)("img",{src:s(79885),alt:"loader",style:{height:"100px"}},null,8,ie)])):(0,r.kq)("",!0),ae.loader?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("button",{key:7,type:"submit",class:"btn btn-primary d-block mt-3",disabled:oe.v$.thesisForm.$invalid}," إضافة ",8,ne))])],32)}var ae=s(50124),he=s(95082),le=s(48534),ce=s(89584),ue=(s(70560),s(38077),s(60228),s(32320),s(62506),s(47522),s(5705)),de=s(10760),pe=s(44106),me=s(53186),fe=s(31025),ge={name:"CreateThesis",components:{ImagePreviewer:me.Z},props:{book:{type:Object,default:null},lastThesis:{type:Object,default:null},thesisToEdit:{type:Object,default:null}},setup:function(){return{v$:(0,ue.ZP)()}},data:function(){return{thesis:!1,screenshots:!1,showPages:!1,loader:!1,startOver:!1,thesisForm:{typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[],type:"thesis",book_id:null,u_comment_id:null},mediaNoteText:"",errorMessage:"",filesLimitError:"",screenshotsDisabled:!1,currentTime:new Date,timer:null}},mounted:function(){var e=this;this.timer=setInterval((function(){e.currentTime=new Date}),1e3)},beforeUnmount:function(){clearInterval(this.timer)},computed:{numberOfPages:function(){return this.thesisForm.end_page-this.thesisForm.start_page+1},successMessage:function(){return this.thesisToEdit?"تم تعديل الأطروحة بنجاح":"تم إضافة الأطروحة بنجاح"},pages:function(){var e,t=[],s=null;this.book.userBooks.length&&"in progress"===this.book.userBooks[0].status?s=this.lastThesis?(null===(e=this.lastThesis)||void 0===e?void 0:e.end_page)+1:this.book.start_page:(!this.book.userBooks.length&&!this.lastThesis||this.book.userBooks.length&&"later"===this.book.userBooks[0].status)&&(s=this.book.start_page);if(this.thesisToEdit&&(s=this.book.start_page),null===s&&!this.startOver)return[];null===s&&this.startOver&&(s=this.book.start_page);for(var r=s;r<=this.book.end_page;r++)t.push(r);return t},bookPagesEnd:function(){var e=this;return this.pages.filter((function(t){return t>e.thesisForm.start_page}))},isTimeValid:function(){var e=fe.Z.convertTZ(this.currentTime,"Asia/Riyadh"),t=e.getDay(),s=e.getHours();e.getMinutes();return 6===t&&s>=21}},watch:{book:function(){this.thesisForm.book_id=this.book.id}},created:function(){if(this.thesisToEdit){var e;this.thesisForm.u_comment_id=parseInt(this.thesisToEdit.id),this.thesisForm.body=this.thesisToEdit.body?this.thesisToEdit.body:"",this.thesisForm.start_page=this.thesisToEdit.thesis.start_page,this.thesisForm.end_page=this.thesisToEdit.thesis.end_page,this.thesisForm.screenShots.old=null!==(e=this.thesisToEdit.media)&&void 0!==e?e:[],this.showPages=!0,!this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||!this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0?this.thesisForm.typeOfThesis="read":(this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0)&&(this.thesisForm.typeOfThesis="readAndWrite"),this.changeTypeOfThesis(this.thesisForm.typeOfThesis);var t=this.checkThesisHasMedia(this.thesisToEdit);this.mediaNoteText=t>0?"ملاحظة: سيتم حذف الصور الموجودين بعد تعديل الأطروحة وعددهم: ".concat(t):""}else{var s;this.thesisForm.book_id=null===(s=this.book)||void 0===s?void 0:s.id}},methods:{showAddThesis:function(){this.thesis=!0,this.screenshots=!1},showAddScreenshots:function(){this.screenshots=!0,this.thesis=!1},noThesisAndScreenshots:function(){this.thesis=!1,this.screenshots=!1},thesisAndScreenshots:function(){this.thesis=!0,this.screenshots=!0},changeTypeOfThesis:function(e){this.showPages=!0,"read"==e?this.noThesisAndScreenshots():"readAndWrite"==e?this.showAddThesis():"screenshots"==e?this.showAddScreenshots():"screenshotsAndWrite"==e?this.thesisAndScreenshots():(this.showPages=!1,this.noThesisAndScreenshots())},previewImages:function(e){var t=e.target.files;t.length>5?this.filesLimitError="لا يمكنك رفع أكثر من 5 اقتباسات":(this.filesLimitError="",this.thesisForm.screenShots=t)},removeImage:function(e){var t=(0,ce.Z)(this.thesisForm.screenShots);t.splice(e,1),this.thesisForm.screenShots=t,0==this.thesisForm.screenShots.length&&(this.$refs.screenShots.value=null)},submit:function(){var e=this;return(0,le.Z)((0,ae.Z)().mark((function t(){var s;return(0,ae.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.v$.$touch(),e.v$.thesisForm.$invalid||!(e.numberOfPages>=3)){t.next=29;break}if(e.loader=!0,t.prev=3,e.updateThesisForm(),!e.thesisToEdit){t.next=11;break}return t.next=8,pe.Z.update(e.thesisForm);case 8:s=t.sent,t.next=14;break;case 11:return t.next=13,pe.Z.create(e.thesisForm);case 13:s=t.sent;case 14:if(200===s.statusCode){t.next=16;break}throw s.data;case 16:fe.Z.toggleToast(e.successMessage,"success"),e.thesisToEdit?setTimeout((function(){location.reload()}),1800):(e.$emit("addThesis",s.data),e.thesisForm=(0,he.Z)((0,he.Z)({},e.thesisForm),{},{typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[]}),e.v$.thesisForm.$reset(),e.changeTypeOfThesis(""),setTimeout((function(){e.$emit("closeModel")}),2e3)),t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](3),fe.Z.toggleErrorToast(),console.log(t.t0);case 24:return t.prev=24,e.loader=!1,t.finish(24);case 27:t.next=30;break;case 29:e.errorMessage="الرجاء ادخال جميع البيانات المطلوبة";case 30:case"end":return t.stop()}}),t,null,[[3,20,24,27]])})))()},updateThesisForm:function(){"read"==this.thesisForm.typeOfThesis?(this.thesisForm.body=null,this.thesisForm.screenShots=[]):"readAndWrite"==this.thesisForm.typeOfThesis?this.thesisForm.screenShots=[]:"screenshots"==this.thesisForm.typeOfThesis&&(this.thesisForm.body=null)},startBookOver:function(){this.startOver=!0},checkThesisHasMedia:function(e){var t,s=0;return e.media&&s++,null!==(t=e.replies)&&void 0!==t&&t.length&&e.replies.forEach((function(e){"screenshot"===e.type&&e.media&&s++})),s},informUserAboutClosingScreenShots:function(){var e=this;if(this.isTimeValid&&!this.$cookies.get("show-closing-screenshots-alert")){var t=this.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg"},buttonsStyling:!1}),s="<p class='text-center'>بسبب كثرة القراء الذين يدخلون تصويت القراءة الآن</p>";s+="<p class='text-center'>لا يتحمل السيرفر <b class='text-danger'>تحميل الصور</b></p>",s+="<p class='text-center'>فضلا ادخل أطروحتك أو اقتباساتك بشكل <b>مكتوب</b></p>",s+="<p class='text-center'>يتاح رفع الصور <span class='text-primary'><b>من الأحد إلى الساعة التاسعة من يوم السبت</b></span> أسبوعياً</p>",t.fire({title:"لا يمكنك وضع اقتباسات مؤقتًا",html:s,showCancelButton:!1,confirmButtonText:"حسنًا",icon:"warning",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then((function(t){t.isConfirmed&&e.$cookies.set("show-closing-screenshots-alert",!0,"1d")}))}}},validations:function(){var e=this;return{thesisForm:{typeOfThesis:{required:de.C1},start_page:{required:de.C1,between:function(t){return parseInt(t)<parseInt(e.thesisForm.end_page)}},end_page:{required:de.C1,between:function(t){return parseInt(t)>parseInt(e.thesisForm.start_page)}},body:{requiredIf:(0,de.CF)((function(){return"readAndWrite"==e.thesisForm.typeOfThesis||"screenshotsAndWrite"==e.thesisForm.typeOfThesis}))},screenShots:{requiredIf:(0,de.CF)((function(){return"screenshots"==e.thesisForm.typeOfThesis||"screenshotsAndWrite"==e.thesisForm.typeOfThesis}))}}}}},ve=s(83744);const ke=(0,ve.Z)(ge,[["render",oe],["__scopeId","data-v-60e63b48"]]);var be=ke},21218:function(e,t,s){e.exports=s.p+"img/200x200-book.5a0360f9.png"}}]);
//# sourceMappingURL=6492-legacy.2eaa7753.js.map